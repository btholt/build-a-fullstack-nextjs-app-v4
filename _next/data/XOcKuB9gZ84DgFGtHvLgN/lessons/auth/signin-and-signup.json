{"pageProps":{"post":{"attributes":{},"html":"<p>We are going to do now do auth using Neon Auth, which under the hood is the same as Stack Auth - they&#39;re just neatly linked if you use Neon and Neon Auth together.</p>\n<ul>\n<li>Head to Neon.com</li>\n<li>Sign up for an account</li>\n<li>Create a new project - use the most recent version of Postgres and it doesn&#39;t matter what cloud or region you choose</li>\n<li>Click on the Neon Auth tab</li>\n<li>Create your Neon Auth integration</li>\n<li>Go to configuration, click generate keys</li>\n<li>Copy the snippet and paste it into a <code>.env</code> file at the root of your project.</li>\n</ul>\n<p>Your new .env file should look like</p>\n<pre><code># Neon Auth environment variables for Next.js\nNEXT_PUBLIC_STACK_PROJECT_ID=&#x27;your project id&#x27;\nNEXT_PUBLIC_STACK_PUBLISHABLE_CLIENT_KEY=&#x27;your publishable key&#x27;\nSTACK_SECRET_SERVER_KEY=&#x27;your secret key&#x27;\n\n# Database owner connection string\nDATABASE_URL=&#x27;your postgres connection string&#x27;\n</code></pre><p>Now that we have that (and as a bonus we&#39;re ready to go for our database too because we got the connection string) we can start adding Neon Auth to our project.</p>\n<p>Now go to the root of your project and run</p>\n<pre><code class=\"hljs language-bash\">npx @stackframe/init-stack@latest --no-browser\n</code></pre><p>This should initiate your project and add some auth files to it.</p>\n<p>Now you should be able to click sign in or sign up from the top bar and actually sign in or sign up. Stack Auth gives a really nice UI that already fits with shadcn so we don&#39;t need to restyle it or anything (though you certainly could!)</p>\n<p>That&#39;s it for intro&#39;ing our sign in and sign out systems. Modern auth companies make this so easy now - it used to be so hard!</p>\n<p>So let&#39;s make it that our sign in and sign out buttons show when the user is signed out, and the official UserButton shows from Stack Auth when the user is signed in.</p>\n<p>In <code>src/app/components/nav/nav-bar</code> put this</p>\n<pre><code class=\"hljs language-typescript\"><span class=\"hljs-comment\">// at top</span>\n<span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">UserButton</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;@stackframe/stack&quot;</span>;\n<span class=\"hljs-keyword\">import</span> { stackServerApp } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;@/stack/server&quot;</span>;\n\n<span class=\"hljs-comment\">// inside function</span>\n<span class=\"hljs-keyword\">const</span> user = <span class=\"hljs-keyword\">await</span> stackServerApp.<span class=\"hljs-title function_\">getUser</span>();\n\n<span class=\"hljs-comment\">// replace inside menu list</span>\n{\n  user ? (\n    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">NavigationMenuItem</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">UserButton</span> /&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">NavigationMenuItem</span>&gt;</span></span>\n  ) : (\n    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">NavigationMenuItem</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Button</span> <span class=\"hljs-attr\">asChild</span> <span class=\"hljs-attr\">variant</span>=<span class=\"hljs-string\">&quot;outline&quot;</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Link</span> <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">&quot;/handler/sign-in&quot;</span>&gt;</span>Sign In<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">Link</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">Button</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">NavigationMenuItem</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">NavigationMenuItem</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Button</span> <span class=\"hljs-attr\">asChild</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Link</span> <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">&quot;/handler/sign-up&quot;</span>&gt;</span>Sign Up<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">Link</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">Button</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">NavigationMenuItem</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/&gt;</span></span>\n  );\n}\n</code></pre><p>Here we&#39;re checking to see if a user exists (which would only exist if they were logged in.) If it exists, show the UserButton from Stack Auth. If not, show our sign in and sign up buttons. Also notice we&#39;re not using the useUser hook - this is a stateful, client-side hook. Because this is a React Server Component, we need to use the server getUser function instead.</p>\n<p>Try clicking into the account settings from the UserButton - Stack Auth ships a whole user management system so you don&#39;t have to!</p>\n","markdown":"We are going to do now do auth using Neon Auth, which under the hood is the same as Stack Auth - they're just neatly linked if you use Neon and Neon Auth together.\n\n- Head to Neon.com\n- Sign up for an account\n- Create a new project - use the most recent version of Postgres and it doesn't matter what cloud or region you choose\n- Click on the Neon Auth tab\n- Create your Neon Auth integration\n- Go to configuration, click generate keys\n- Copy the snippet and paste it into a `.env` file at the root of your project.\n\nYour new .env file should look like\n\n```\n# Neon Auth environment variables for Next.js\nNEXT_PUBLIC_STACK_PROJECT_ID='your project id'\nNEXT_PUBLIC_STACK_PUBLISHABLE_CLIENT_KEY='your publishable key'\nSTACK_SECRET_SERVER_KEY='your secret key'\n\n# Database owner connection string\nDATABASE_URL='your postgres connection string'\n```\n\nNow that we have that (and as a bonus we're ready to go for our database too because we got the connection string) we can start adding Neon Auth to our project.\n\nNow go to the root of your project and run\n\n```bash\nnpx @stackframe/init-stack@latest --no-browser\n```\n\nThis should initiate your project and add some auth files to it.\n\nNow you should be able to click sign in or sign up from the top bar and actually sign in or sign up. Stack Auth gives a really nice UI that already fits with shadcn so we don't need to restyle it or anything (though you certainly could!)\n\nThat's it for intro'ing our sign in and sign out systems. Modern auth companies make this so easy now - it used to be so hard!\n\nSo let's make it that our sign in and sign out buttons show when the user is signed out, and the official UserButton shows from Stack Auth when the user is signed in.\n\nIn `src/app/components/nav/nav-bar` put this\n\n```typescript\n// at top\nimport { UserButton } from \"@stackframe/stack\";\nimport { stackServerApp } from \"@/stack/server\";\n\n// inside function\nconst user = await stackServerApp.getUser();\n\n// replace inside menu list\n{\n  user ? (\n    <NavigationMenuItem>\n      <UserButton />\n    </NavigationMenuItem>\n  ) : (\n    <>\n      <NavigationMenuItem>\n        <Button asChild variant=\"outline\">\n          <Link href=\"/handler/sign-in\">Sign In</Link>\n        </Button>\n      </NavigationMenuItem>\n      <NavigationMenuItem>\n        <Button asChild>\n          <Link href=\"/handler/sign-up\">Sign Up</Link>\n        </Button>\n      </NavigationMenuItem>\n    </>\n  );\n}\n```\n\nHere we're checking to see if a user exists (which would only exist if they were logged in.) If it exists, show the UserButton from Stack Auth. If not, show our sign in and sign up buttons. Also notice we're not using the useUser hook - this is a stateful, client-side hook. Because this is a React Server Component, we need to use the server getUser function instead.\n\nTry clicking into the account settings from the UserButton - Stack Auth ships a whole user management system so you don't have to!\n","slug":"signin-and-signup","title":"Signin and Signup","section":"Auth","icon":"user-lock","filePath":"/home/runner/work/build-a-fullstack-nextjs-app-v4/build-a-fullstack-nextjs-app-v4/lessons/03-auth/A-signin-and-signup.md","nextSlug":"/lessons/auth/protecting-routes","prevSlug":"/lessons/styling/complete-ui"}},"__N_SSG":true}