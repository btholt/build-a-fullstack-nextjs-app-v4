{"pageProps":{"post":{"attributes":{"title":"AI Inference"},"html":"<p>Let&#39;s build!</p>\n<p>In your src directory, create an ai directory. In there put a summarize.ts file and put this in there</p>\n<pre><code class=\"hljs language-typescript\"><span class=\"hljs-keyword\">import</span> { generateText } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;ai&quot;</span>;\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">summarizeArticle</span>(<span class=\"hljs-params\">\n  <span class=\"hljs-attr\">title</span>: <span class=\"hljs-built_in\">string</span>,\n  <span class=\"hljs-attr\">article</span>: <span class=\"hljs-built_in\">string</span>\n</span>): <span class=\"hljs-title class_\">Promise</span>&lt;<span class=\"hljs-built_in\">string</span>&gt; {\n  <span class=\"hljs-keyword\">if</span> (!article || !article.<span class=\"hljs-title function_\">trim</span>()) {\n    <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Error</span>(<span class=\"hljs-string\">&quot;Article content is required to generate a summary.&quot;</span>);\n  }\n\n  <span class=\"hljs-keyword\">const</span> prompt = <span class=\"hljs-string\">`Summarize the following wiki article in 1-2 concise sentences. Focus on the main idea and the most important details a reader should remember. Do not add opinions or unrelated information. The point is that readers can see the summary a glance and decide if they want to read more.\\n\\nTitle:\\n<span class=\"hljs-subst\">${title}</span>\\n\\nArticle:\\n<span class=\"hljs-subst\">${article}</span>`</span>;\n\n  <span class=\"hljs-keyword\">const</span> { text } = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">generateText</span>({\n    <span class=\"hljs-attr\">model</span>: <span class=\"hljs-string\">&quot;openai/gpt-5-nano&quot;</span>,\n    <span class=\"hljs-attr\">system</span>: <span class=\"hljs-string\">&quot;You are an assistant that writes concise factual summaries.&quot;</span>,\n    prompt,\n  });\n\n  <span class=\"hljs-keyword\">return</span> (text ?? <span class=\"hljs-string\">&quot;&quot;</span>).<span class=\"hljs-title function_\">trim</span>();\n}\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> summarizeArticle;\n</code></pre><p>I love the AI SDK. It&#39;s a much nicer experience than say the OpenAI SDK&#39;s rituals can be, in my opinion.</p>\n<p>What&#39;s cool about the AI SDK is you can easily switch it to use Anthropic, OpenAI, etc. directly instead of going through Vercel. Smart marketing on their part because it means you can use their SDK no matter what and it&#39;s easy to switch to their AI Gateway</p>\n<p>Let&#39;s say you wanted to use Anthropic directly. Here&#39;s what you&#39;d do.</p>\n<blockquote>\n<p>I&#39;m going to use the Vercel AI Gateway so only do these next steps if you want to switch. I just wanted to show you how easy it is to switch.</p>\n</blockquote>\n<pre><code class=\"hljs language-bash\">npm i @ai-sdk/anthropic\n</code></pre><pre><code class=\"hljs language-typescript\"><span class=\"hljs-comment\">// at top</span>\n<span class=\"hljs-keyword\">import</span> { anthropic } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;@ai-sdk/anthropic&quot;</span>;\n\n<span class=\"hljs-comment\">// replace model</span>\n<span class=\"hljs-attr\">model</span>: <span class=\"hljs-title function_\">anthropic</span>(<span class=\"hljs-string\">&quot;claude-haiku-4-5&quot;</span>),\n</code></pre><p>That&#39;s it! Now instead of going to Vercel&#39;s AI Gateway, you&#39;re going directly Anthropic. This would be helpful if you already had money on your Anthropic account and didn&#39;t want to fill up a Vercel account. We&#39;re not doing this, and we&#39;re just going to use Vercel&#39;s AI Gateway.</p>\n<blockquote>\n<p>I chose <code>openai/gpt-5-nano</code> because it was cheapest of the frontier models as of writing. Summarizing is the most basic AI task and basically any model can do it pretty well. Feel free to experiment here. <a href=\"https://vercel.com/ai-gateway/models\">Here are the models supported</a>. Also, just throwing out that the prompt could be improved. This will do the job but feel free to iterate.</p>\n</blockquote>\n<p>Okay, let&#39;s add it to our server actions. Update actions/articles.ts</p>\n<pre><code class=\"hljs language-typescript\"><span class=\"hljs-comment\">// at top</span>\n<span class=\"hljs-keyword\">import</span> summarizeArticle <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;@/ai/summarize&quot;</span>;\n\n<span class=\"hljs-comment\">// replace db call in create</span>\n<span class=\"hljs-keyword\">const</span> summary = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">summarizeArticle</span>(data.<span class=\"hljs-property\">title</span> || <span class=\"hljs-string\">&quot;&quot;</span>, data.<span class=\"hljs-property\">content</span> || <span class=\"hljs-string\">&quot;&quot;</span>);\n<span class=\"hljs-keyword\">const</span> response = <span class=\"hljs-keyword\">await</span> db.<span class=\"hljs-title function_\">insert</span>(articles).<span class=\"hljs-title function_\">values</span>({\n  <span class=\"hljs-attr\">title</span>: data.<span class=\"hljs-property\">title</span>,\n  <span class=\"hljs-attr\">content</span>: data.<span class=\"hljs-property\">content</span>,\n  <span class=\"hljs-attr\">slug</span>: <span class=\"hljs-string\">&quot;&quot;</span> + <span class=\"hljs-title class_\">Date</span>.<span class=\"hljs-title function_\">now</span>(),\n  <span class=\"hljs-attr\">published</span>: <span class=\"hljs-literal\">true</span>,\n  <span class=\"hljs-attr\">authorId</span>: user.<span class=\"hljs-property\">id</span>,\n  <span class=\"hljs-attr\">imageUrl</span>: data.<span class=\"hljs-property\">imageUrl</span> ?? <span class=\"hljs-literal\">undefined</span>,\n  summary, <span class=\"hljs-comment\">// add</span>\n});\n\n<span class=\"hljs-comment\">// replace db call in update</span>\n<span class=\"hljs-keyword\">const</span> summary = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">summarizeArticle</span>(data.<span class=\"hljs-property\">title</span> || <span class=\"hljs-string\">&quot;&quot;</span>, data.<span class=\"hljs-property\">content</span> || <span class=\"hljs-string\">&quot;&quot;</span>);\n<span class=\"hljs-keyword\">const</span> response = <span class=\"hljs-keyword\">await</span> db\n  .<span class=\"hljs-title function_\">update</span>(articles)\n  .<span class=\"hljs-title function_\">set</span>({\n    <span class=\"hljs-attr\">title</span>: data.<span class=\"hljs-property\">title</span>,\n    <span class=\"hljs-attr\">content</span>: data.<span class=\"hljs-property\">content</span>,\n    <span class=\"hljs-attr\">imageUrl</span>: data.<span class=\"hljs-property\">imageUrl</span> ?? <span class=\"hljs-literal\">undefined</span>,\n    <span class=\"hljs-attr\">summary</span>: summary ?? <span class=\"hljs-literal\">undefined</span>, <span class=\"hljs-comment\">// add</span>\n  })\n  .<span class=\"hljs-title function_\">where</span>(<span class=\"hljs-title function_\">eq</span>(articles.<span class=\"hljs-property\">id</span>, +id));\n</code></pre><ul>\n<li>We&#39;re just using our new module and inserting into the database.</li>\n<li>The summary <em>and</em> the title should always be there from the frontend. If it wasn&#39;t then we&#39;d need to select the necessary fields from the database and then do the summary. You could be more defensive here, but I&#39;m keeping it simple.</li>\n</ul>\n<p>Let&#39;s go add it to the database. Go to db/schema.ts</p>\n<pre><code class=\"hljs language-typescript\"><span class=\"hljs-comment\">// add the row</span>\n<span class=\"hljs-attr\">summary</span>: <span class=\"hljs-title function_\">text</span>(<span class=\"hljs-string\">&quot;summary&quot;</span>),\n</code></pre><p>Now run these CLI commands</p>\n<pre><code class=\"hljs language-typescript\">npm run <span class=\"hljs-attr\">db</span>:generate\nnpm run <span class=\"hljs-attr\">db</span>:migrate\n</code></pre><blockquote>\n<p>You may have a problem with untracked migrations, particularly if you played around with <code>drizzle-kit push</code>. There&#39;s a bunch of ways to handle this, but I found the easiest way to just drop the articles table and <code>npm run db:migrate</code> again and then run <code>npm run db:seed</code> again.</p>\n</blockquote>\n<p>Awesome, now, finally, let&#39;s add it to the select in data/articles.ts</p>\n<pre><code class=\"hljs language-typescript\"><span class=\"hljs-comment\">// replace `getArticles` field</span>\n<span class=\"hljs-attr\">summary</span>: articles.<span class=\"hljs-property\">summary</span>,\n</code></pre><p>Now we can see the summary on the home page for new and edited articles!</p>\n","markdown":"\nLet's build!\n\nIn your src directory, create an ai directory. In there put a summarize.ts file and put this in there\n\n```typescript\nimport { generateText } from \"ai\";\n\nexport async function summarizeArticle(\n  title: string,\n  article: string\n): Promise<string> {\n  if (!article || !article.trim()) {\n    throw new Error(\"Article content is required to generate a summary.\");\n  }\n\n  const prompt = `Summarize the following wiki article in 1-2 concise sentences. Focus on the main idea and the most important details a reader should remember. Do not add opinions or unrelated information. The point is that readers can see the summary a glance and decide if they want to read more.\\n\\nTitle:\\n${title}\\n\\nArticle:\\n${article}`;\n\n  const { text } = await generateText({\n    model: \"openai/gpt-5-nano\",\n    system: \"You are an assistant that writes concise factual summaries.\",\n    prompt,\n  });\n\n  return (text ?? \"\").trim();\n}\n\nexport default summarizeArticle;\n```\n\nI love the AI SDK. It's a much nicer experience than say the OpenAI SDK's rituals can be, in my opinion.\n\nWhat's cool about the AI SDK is you can easily switch it to use Anthropic, OpenAI, etc. directly instead of going through Vercel. Smart marketing on their part because it means you can use their SDK no matter what and it's easy to switch to their AI Gateway\n\nLet's say you wanted to use Anthropic directly. Here's what you'd do.\n\n> I'm going to use the Vercel AI Gateway so only do these next steps if you want to switch. I just wanted to show you how easy it is to switch.\n\n```bash\nnpm i @ai-sdk/anthropic\n```\n\n```typescript\n// at top\nimport { anthropic } from \"@ai-sdk/anthropic\";\n\n// replace model\nmodel: anthropic(\"claude-haiku-4-5\"),\n```\n\nThat's it! Now instead of going to Vercel's AI Gateway, you're going directly Anthropic. This would be helpful if you already had money on your Anthropic account and didn't want to fill up a Vercel account. We're not doing this, and we're just going to use Vercel's AI Gateway.\n\n> I chose `openai/gpt-5-nano` because it was cheapest of the frontier models as of writing. Summarizing is the most basic AI task and basically any model can do it pretty well. Feel free to experiment here. [Here are the models supported][gateway]. Also, just throwing out that the prompt could be improved. This will do the job but feel free to iterate.\n\nOkay, let's add it to our server actions. Update actions/articles.ts\n\n```typescript\n// at top\nimport summarizeArticle from \"@/ai/summarize\";\n\n// replace db call in create\nconst summary = await summarizeArticle(data.title || \"\", data.content || \"\");\nconst response = await db.insert(articles).values({\n  title: data.title,\n  content: data.content,\n  slug: \"\" + Date.now(),\n  published: true,\n  authorId: user.id,\n  imageUrl: data.imageUrl ?? undefined,\n  summary, // add\n});\n\n// replace db call in update\nconst summary = await summarizeArticle(data.title || \"\", data.content || \"\");\nconst response = await db\n  .update(articles)\n  .set({\n    title: data.title,\n    content: data.content,\n    imageUrl: data.imageUrl ?? undefined,\n    summary: summary ?? undefined, // add\n  })\n  .where(eq(articles.id, +id));\n```\n\n- We're just using our new module and inserting into the database.\n- The summary _and_ the title should always be there from the frontend. If it wasn't then we'd need to select the necessary fields from the database and then do the summary. You could be more defensive here, but I'm keeping it simple.\n\nLet's go add it to the database. Go to db/schema.ts\n\n```typescript\n// add the row\nsummary: text(\"summary\"),\n```\n\nNow run these CLI commands\n\n```typescript\nnpm run db:generate\nnpm run db:migrate\n```\n\n> You may have a problem with untracked migrations, particularly if you played around with `drizzle-kit push`. There's a bunch of ways to handle this, but I found the easiest way to just drop the articles table and `npm run db:migrate` again and then run `npm run db:seed` again.\n\nAwesome, now, finally, let's add it to the select in data/articles.ts\n\n```typescript\n// replace `getArticles` field\nsummary: articles.summary,\n```\n\nNow we can see the summary on the home page for new and edited articles!\n\n[gateway]: https://vercel.com/ai-gateway/models\n","slug":"ai-inference","title":"AI Inference","section":"AI","icon":"robot","filePath":"/home/runner/work/build-a-fullstack-nextjs-app-v4/build-a-fullstack-nextjs-app-v4/lessons/08-ai/B-ai-inference.md","nextSlug":"/lessons/ai/cron","prevSlug":"/lessons/ai/vercel-ai-gateway"}},"__N_SSG":true}