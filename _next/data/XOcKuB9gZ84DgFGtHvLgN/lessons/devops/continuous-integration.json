{"pageProps":{"post":{"attributes":{},"html":"<p>We can deliver our code to production, and we can monitor it once it&#39;s there, but how do we ensure code quality and prevent issues before we even have them?</p>\n<p>Continuous Integration, the CI portion of CI/CD.</p>\n<p>We are going to use GitHub Actions for this (as it&#39;s a great platform for most use cases) but there&#39;s a trillion providers out there that do this.</p>\n<p>I&#39;ve already put this file in there in your repo, but I&#39;m going to code this up with you as it&#39;s a doozy. A lot CI can be pretty simple, but this full stack enterprise, let&#39;s throw the kitchen sink at it.</p>\n<pre><code class=\"hljs language-yaml\"><span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">CI</span>\n\n<span class=\"hljs-attr\">on:</span>\n  <span class=\"hljs-attr\">push:</span>\n    <span class=\"hljs-attr\">branches:</span> [<span class=\"hljs-string\">main</span>]\n  <span class=\"hljs-attr\">pull_request:</span>\n    <span class=\"hljs-attr\">branches:</span> [<span class=\"hljs-string\">main</span>]\n\n<span class=\"hljs-attr\">jobs:</span>\n  <span class=\"hljs-attr\">lint-and-format:</span>\n    <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Lint</span> <span class=\"hljs-string\">and</span> <span class=\"hljs-string\">Format</span> <span class=\"hljs-string\">Check</span>\n    <span class=\"hljs-attr\">runs-on:</span> <span class=\"hljs-string\">ubuntu-latest</span>\n\n    <span class=\"hljs-attr\">steps:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Checkout</span> <span class=\"hljs-string\">code</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">actions/checkout@v4</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Setup</span> <span class=\"hljs-string\">Node.js</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">actions/setup-node@v4</span>\n        <span class=\"hljs-attr\">with:</span>\n          <span class=\"hljs-attr\">node-version:</span> <span class=\"hljs-string\">&quot;22&quot;</span>\n          <span class=\"hljs-attr\">cache:</span> <span class=\"hljs-string\">&quot;npm&quot;</span>\n          <span class=\"hljs-attr\">cache-dependency-path:</span> <span class=\"hljs-string\">package-lock.json</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Install</span> <span class=\"hljs-string\">dependencies</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">ci</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Run</span> <span class=\"hljs-string\">Biome</span> <span class=\"hljs-string\">check</span> <span class=\"hljs-string\">(lint</span> <span class=\"hljs-string\">+</span> <span class=\"hljs-string\">format)</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">run</span> <span class=\"hljs-string\">lint</span>\n\n  <span class=\"hljs-attr\">unit-tests:</span>\n    <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Unit</span> <span class=\"hljs-string\">Tests</span>\n    <span class=\"hljs-attr\">runs-on:</span> <span class=\"hljs-string\">ubuntu-latest</span>\n\n    <span class=\"hljs-attr\">steps:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Checkout</span> <span class=\"hljs-string\">code</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">actions/checkout@v4</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Setup</span> <span class=\"hljs-string\">Node.js</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">actions/setup-node@v4</span>\n        <span class=\"hljs-attr\">with:</span>\n          <span class=\"hljs-attr\">node-version:</span> <span class=\"hljs-string\">&quot;22&quot;</span>\n          <span class=\"hljs-attr\">cache:</span> <span class=\"hljs-string\">&quot;npm&quot;</span>\n          <span class=\"hljs-attr\">cache-dependency-path:</span> <span class=\"hljs-string\">package-lock.json</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Get</span> <span class=\"hljs-string\">Neon</span> <span class=\"hljs-string\">branch</span> <span class=\"hljs-string\">name</span>\n        <span class=\"hljs-attr\">id:</span> <span class=\"hljs-string\">neon-branch-name</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">echo</span> <span class=\"hljs-string\">&quot;BRANCH_NAME=unit-$<span class=\"hljs-template-variable\">{{ github.run_id }}</span>&quot;</span> <span class=\"hljs-string\">&gt;&gt;</span> <span class=\"hljs-string\">&quot;$GITHUB_ENV&quot;</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Get</span> <span class=\"hljs-string\">branch</span> <span class=\"hljs-string\">expiration</span> <span class=\"hljs-string\">date</span> <span class=\"hljs-string\">as</span> <span class=\"hljs-string\">an</span> <span class=\"hljs-string\">env</span> <span class=\"hljs-string\">variable</span> <span class=\"hljs-string\">(2</span> <span class=\"hljs-string\">weeks</span> <span class=\"hljs-string\">from</span> <span class=\"hljs-string\">now)</span>\n        <span class=\"hljs-attr\">id:</span> <span class=\"hljs-string\">get-expiration-date</span>\n        <span class=\"hljs-attr\">run:</span>\n          <span class=\"hljs-string\">echo</span> <span class=\"hljs-string\">&quot;EXPIRES_AT=$(date -u --date &#x27;+14 days&#x27; +&#x27;%Y-%m-%dT%H:%M:%SZ&#x27;)&quot;</span>\n          <span class=\"hljs-string\">&gt;&gt;</span> <span class=\"hljs-string\">&quot;$GITHUB_ENV&quot;</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Create</span> <span class=\"hljs-string\">Neon</span> <span class=\"hljs-string\">Branch</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">neondatabase/create-branch-action@v6</span>\n        <span class=\"hljs-attr\">id:</span> <span class=\"hljs-string\">create-neon-branch</span>\n        <span class=\"hljs-attr\">with:</span>\n          <span class=\"hljs-attr\">project_id:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.NEON_PROJECT_ID</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">branch_name:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">env.BRANCH_NAME</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">api_key:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.NEON_API_KEY</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">expires_at:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">env.EXPIRES_AT</span> <span class=\"hljs-string\">}}</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Install</span> <span class=\"hljs-string\">dependencies</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">ci</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Run</span> <span class=\"hljs-string\">unit</span> <span class=\"hljs-string\">tests</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">run</span> <span class=\"hljs-string\">test</span>\n        <span class=\"hljs-attr\">env:</span>\n          <span class=\"hljs-attr\">DATABASE_URL:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">steps.create-neon-branch.outputs.db_url</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">NODE_ENV:</span> <span class=\"hljs-string\">test</span>\n          <span class=\"hljs-attr\">NEON_PROJECT_ID:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.NEON_PROJECT_ID</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">NEON_API_KEY:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.NEON_API_KEY</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">NEON_BRANCH_NAME:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">env.BRANCH_NAME</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">TEST_USER_EMAIL:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.TEST_USER_EMAIL</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">TEST_USER_PASSWORD:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.TEST_USER_PASSWORD</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">NEXT_PUBLIC_STACK_PROJECT_ID:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.NEXT_PUBLIC_STACK_PROJECT_ID</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">NEXT_PUBLIC_STACK_PUBLISHABLE_CLIENT_KEY:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.NEXT_PUBLIC_STACK_PUBLISHABLE_CLIENT_KEY</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">STACK_SECRET_SERVER_KEY:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.STACK_SECRET_SERVER_KEY</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">UPSTASH_REDIS_REST_URL:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.UPSTASH_REDIS_REST_URL</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">UPSTASH_REDIS_REST_TOKEN:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.UPSTASH_REDIS_REST_TOKEN</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">BLOB_READ_WRITE_TOKEN:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.BLOB_READ_WRITE_TOKEN</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">BLOB_BASE_URL:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.BLOB_BASE_URL</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">RESEND_API_KEY:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.RESEND_API_KEY</span> <span class=\"hljs-string\">}}</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Delete</span> <span class=\"hljs-string\">Neon</span> <span class=\"hljs-string\">Branch</span>\n        <span class=\"hljs-attr\">if:</span> <span class=\"hljs-string\">always()</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">neondatabase/delete-branch-action@v3</span>\n        <span class=\"hljs-attr\">with:</span>\n          <span class=\"hljs-attr\">project_id:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.NEON_PROJECT_ID</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">branch:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">env.BRANCH_NAME</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">api_key:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.NEON_API_KEY</span> <span class=\"hljs-string\">}}</span>\n\n  <span class=\"hljs-attr\">e2e-tests:</span>\n    <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">E2E</span> <span class=\"hljs-string\">Tests</span>\n    <span class=\"hljs-attr\">runs-on:</span> <span class=\"hljs-string\">ubuntu-latest</span>\n\n    <span class=\"hljs-attr\">steps:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Checkout</span> <span class=\"hljs-string\">code</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">actions/checkout@v4</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Setup</span> <span class=\"hljs-string\">Node.js</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">actions/setup-node@v4</span>\n        <span class=\"hljs-attr\">with:</span>\n          <span class=\"hljs-attr\">node-version:</span> <span class=\"hljs-string\">&quot;22&quot;</span>\n          <span class=\"hljs-attr\">cache:</span> <span class=\"hljs-string\">&quot;npm&quot;</span>\n          <span class=\"hljs-attr\">cache-dependency-path:</span> <span class=\"hljs-string\">package-lock.json</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Get</span> <span class=\"hljs-string\">Neon</span> <span class=\"hljs-string\">branch</span> <span class=\"hljs-string\">name</span>\n        <span class=\"hljs-attr\">id:</span> <span class=\"hljs-string\">neon-branch-name</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">echo</span> <span class=\"hljs-string\">&quot;BRANCH_NAME=e2e-$<span class=\"hljs-template-variable\">{{ github.run_id }}</span>&quot;</span> <span class=\"hljs-string\">&gt;&gt;</span> <span class=\"hljs-string\">&quot;$GITHUB_ENV&quot;</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Get</span> <span class=\"hljs-string\">branch</span> <span class=\"hljs-string\">expiration</span> <span class=\"hljs-string\">date</span> <span class=\"hljs-string\">as</span> <span class=\"hljs-string\">an</span> <span class=\"hljs-string\">env</span> <span class=\"hljs-string\">variable</span> <span class=\"hljs-string\">(2</span> <span class=\"hljs-string\">weeks</span> <span class=\"hljs-string\">from</span> <span class=\"hljs-string\">now)</span>\n        <span class=\"hljs-attr\">id:</span> <span class=\"hljs-string\">get-expiration-date</span>\n        <span class=\"hljs-attr\">run:</span>\n          <span class=\"hljs-string\">echo</span> <span class=\"hljs-string\">&quot;EXPIRES_AT=$(date -u --date &#x27;+14 days&#x27; +&#x27;%Y-%m-%dT%H:%M:%SZ&#x27;)&quot;</span>\n          <span class=\"hljs-string\">&gt;&gt;</span> <span class=\"hljs-string\">&quot;$GITHUB_ENV&quot;</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Create</span> <span class=\"hljs-string\">Neon</span> <span class=\"hljs-string\">Branch</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">neondatabase/create-branch-action@v6</span>\n        <span class=\"hljs-attr\">id:</span> <span class=\"hljs-string\">create-neon-branch</span>\n        <span class=\"hljs-attr\">with:</span>\n          <span class=\"hljs-attr\">project_id:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.NEON_PROJECT_ID</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">branch_name:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">env.BRANCH_NAME</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">api_key:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.NEON_API_KEY</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">expires_at:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">env.EXPIRES_AT</span> <span class=\"hljs-string\">}}</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Install</span> <span class=\"hljs-string\">dependencies</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">ci</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Install</span> <span class=\"hljs-string\">Playwright</span> <span class=\"hljs-string\">browsers</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">npx</span> <span class=\"hljs-string\">playwright</span> <span class=\"hljs-string\">install</span> <span class=\"hljs-string\">--with-deps</span> <span class=\"hljs-string\">chromium</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Run</span> <span class=\"hljs-string\">E2E</span> <span class=\"hljs-string\">tests</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">run</span> <span class=\"hljs-string\">test:e2e:ci</span>\n        <span class=\"hljs-attr\">env:</span>\n          <span class=\"hljs-attr\">NODE_ENV:</span> <span class=\"hljs-string\">test</span>\n          <span class=\"hljs-attr\">DATABASE_URL:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">steps.create-neon-branch.outputs.db_url</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">NEON_PROJECT_ID:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.NEON_PROJECT_ID</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">NEON_API_KEY:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.NEON_API_KEY</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">NEON_BRANCH_NAME:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">env.BRANCH_NAME</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">TEST_USER_EMAIL:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.TEST_USER_EMAIL</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">TEST_USER_PASSWORD:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.TEST_USER_PASSWORD</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">NEXT_PUBLIC_STACK_PROJECT_ID:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.NEXT_PUBLIC_STACK_PROJECT_ID</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">NEXT_PUBLIC_STACK_PUBLISHABLE_CLIENT_KEY:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.NEXT_PUBLIC_STACK_PUBLISHABLE_CLIENT_KEY</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">STACK_SECRET_SERVER_KEY:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.STACK_SECRET_SERVER_KEY</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">UPSTASH_REDIS_REST_URL:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.UPSTASH_REDIS_REST_URL</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">UPSTASH_REDIS_REST_TOKEN:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.UPSTASH_REDIS_REST_TOKEN</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">BLOB_READ_WRITE_TOKEN:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.BLOB_READ_WRITE_TOKEN</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">BLOB_BASE_URL:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.BLOB_BASE_URL</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">RESEND_API_KEY:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.RESEND_API_KEY</span> <span class=\"hljs-string\">}}</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Delete</span> <span class=\"hljs-string\">Neon</span> <span class=\"hljs-string\">Branch</span>\n        <span class=\"hljs-attr\">if:</span> <span class=\"hljs-string\">always()</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">neondatabase/delete-branch-action@v3</span>\n        <span class=\"hljs-attr\">with:</span>\n          <span class=\"hljs-attr\">project_id:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.NEON_PROJECT_ID</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">branch:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">env.BRANCH_NAME</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">api_key:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.NEON_API_KEY</span> <span class=\"hljs-string\">}}</span>\n</code></pre><ul>\n<li>This is fairly sophisticated. For reference,<a href=\"https://github.com/btholt/build-a-fullstack-nextjs-app-v4/blob/main/.github/workflows/next.yaml\"> here&#39;s the one that deploys this course website</a> to GitHub pages. Basically build and ship.</li>\n<li>In this one, we run it whenever new commits land in main and we also run it on PRs automatically.</li>\n<li>We then split the run into four parts so they can be run on three separate machines and go fast: type check with TypeScript, lint/format with Biome, unit test with Vitest, and E2E test with Playwright.</li>\n<li>In each one we set up Node.js, we install deps, and we run the testing scripts. For Playwright, we do need to build the server as well so it can actually run and have Playwright test it.</li>\n<li>We pass in the variables (that we&#39;ll set up shortly in GitHub) so that they can be used for testing purposes. These will come from secret variables we set up.</li>\n<li>We could go through and split hairs about what is a variable and what is a secret, but I&#39;m just making everything a secret.</li>\n</ul>\n<p>Let&#39;s go to the repo, to settings, to secrets and variables, and add all of our <em>test</em> variables into here. You have to do it one-by-one which is a bit of a pain, but once you&#39;ve done that, you&#39;re ready to run your CI checks! You may find you need to fix some Biome errors. But now we can&#39;t merge anything that doesn&#39;t pass type checking, linting, formatting, unit tests, and E2E tests. That&#39;s a good first step of assurance that bad stuff isn&#39;t going out.</p>\n<p>Okay, now that you have and it&#39;s committed, push it to the repo and you should see it start running on every commit and PR. E2E tests take quite a bit longer to run because they set up Chromium every time.</p>\n<p>Hooray! Code quality!</p>\n","markdown":"We can deliver our code to production, and we can monitor it once it's there, but how do we ensure code quality and prevent issues before we even have them?\n\nContinuous Integration, the CI portion of CI/CD.\n\nWe are going to use GitHub Actions for this (as it's a great platform for most use cases) but there's a trillion providers out there that do this.\n\nI've already put this file in there in your repo, but I'm going to code this up with you as it's a doozy. A lot CI can be pretty simple, but this full stack enterprise, let's throw the kitchen sink at it.\n\n```yaml\nname: CI\n\non:\n  push:\n    branches: [main]\n  pull_request:\n    branches: [main]\n\njobs:\n  lint-and-format:\n    name: Lint and Format Check\n    runs-on: ubuntu-latest\n\n    steps:\n      - name: Checkout code\n        uses: actions/checkout@v4\n\n      - name: Setup Node.js\n        uses: actions/setup-node@v4\n        with:\n          node-version: \"22\"\n          cache: \"npm\"\n          cache-dependency-path: package-lock.json\n\n      - name: Install dependencies\n        run: npm ci\n\n      - name: Run Biome check (lint + format)\n        run: npm run lint\n\n  unit-tests:\n    name: Unit Tests\n    runs-on: ubuntu-latest\n\n    steps:\n      - name: Checkout code\n        uses: actions/checkout@v4\n\n      - name: Setup Node.js\n        uses: actions/setup-node@v4\n        with:\n          node-version: \"22\"\n          cache: \"npm\"\n          cache-dependency-path: package-lock.json\n\n      - name: Get Neon branch name\n        id: neon-branch-name\n        run: echo \"BRANCH_NAME=unit-${{ github.run_id }}\" >> \"$GITHUB_ENV\"\n\n      - name: Get branch expiration date as an env variable (2 weeks from now)\n        id: get-expiration-date\n        run:\n          echo \"EXPIRES_AT=$(date -u --date '+14 days' +'%Y-%m-%dT%H:%M:%SZ')\"\n          >> \"$GITHUB_ENV\"\n\n      - name: Create Neon Branch\n        uses: neondatabase/create-branch-action@v6\n        id: create-neon-branch\n        with:\n          project_id: ${{ secrets.NEON_PROJECT_ID }}\n          branch_name: ${{ env.BRANCH_NAME }}\n          api_key: ${{ secrets.NEON_API_KEY }}\n          expires_at: ${{ env.EXPIRES_AT }}\n\n      - name: Install dependencies\n        run: npm ci\n\n      - name: Run unit tests\n        run: npm run test\n        env:\n          DATABASE_URL: ${{ steps.create-neon-branch.outputs.db_url }}\n          NODE_ENV: test\n          NEON_PROJECT_ID: ${{ secrets.NEON_PROJECT_ID }}\n          NEON_API_KEY: ${{ secrets.NEON_API_KEY }}\n          NEON_BRANCH_NAME: ${{ env.BRANCH_NAME }}\n          TEST_USER_EMAIL: ${{ secrets.TEST_USER_EMAIL }}\n          TEST_USER_PASSWORD: ${{ secrets.TEST_USER_PASSWORD }}\n          NEXT_PUBLIC_STACK_PROJECT_ID: ${{ secrets.NEXT_PUBLIC_STACK_PROJECT_ID }}\n          NEXT_PUBLIC_STACK_PUBLISHABLE_CLIENT_KEY: ${{ secrets.NEXT_PUBLIC_STACK_PUBLISHABLE_CLIENT_KEY }}\n          STACK_SECRET_SERVER_KEY: ${{ secrets.STACK_SECRET_SERVER_KEY }}\n          UPSTASH_REDIS_REST_URL: ${{ secrets.UPSTASH_REDIS_REST_URL }}\n          UPSTASH_REDIS_REST_TOKEN: ${{ secrets.UPSTASH_REDIS_REST_TOKEN }}\n          BLOB_READ_WRITE_TOKEN: ${{ secrets.BLOB_READ_WRITE_TOKEN }}\n          BLOB_BASE_URL: ${{ secrets.BLOB_BASE_URL }}\n          RESEND_API_KEY: ${{ secrets.RESEND_API_KEY }}\n\n      - name: Delete Neon Branch\n        if: always()\n        uses: neondatabase/delete-branch-action@v3\n        with:\n          project_id: ${{ secrets.NEON_PROJECT_ID }}\n          branch: ${{ env.BRANCH_NAME }}\n          api_key: ${{ secrets.NEON_API_KEY }}\n\n  e2e-tests:\n    name: E2E Tests\n    runs-on: ubuntu-latest\n\n    steps:\n      - name: Checkout code\n        uses: actions/checkout@v4\n\n      - name: Setup Node.js\n        uses: actions/setup-node@v4\n        with:\n          node-version: \"22\"\n          cache: \"npm\"\n          cache-dependency-path: package-lock.json\n\n      - name: Get Neon branch name\n        id: neon-branch-name\n        run: echo \"BRANCH_NAME=e2e-${{ github.run_id }}\" >> \"$GITHUB_ENV\"\n\n      - name: Get branch expiration date as an env variable (2 weeks from now)\n        id: get-expiration-date\n        run:\n          echo \"EXPIRES_AT=$(date -u --date '+14 days' +'%Y-%m-%dT%H:%M:%SZ')\"\n          >> \"$GITHUB_ENV\"\n\n      - name: Create Neon Branch\n        uses: neondatabase/create-branch-action@v6\n        id: create-neon-branch\n        with:\n          project_id: ${{ secrets.NEON_PROJECT_ID }}\n          branch_name: ${{ env.BRANCH_NAME }}\n          api_key: ${{ secrets.NEON_API_KEY }}\n          expires_at: ${{ env.EXPIRES_AT }}\n\n      - name: Install dependencies\n        run: npm ci\n\n      - name: Install Playwright browsers\n        run: npx playwright install --with-deps chromium\n\n      - name: Run E2E tests\n        run: npm run test:e2e:ci\n        env:\n          NODE_ENV: test\n          DATABASE_URL: ${{ steps.create-neon-branch.outputs.db_url }}\n          NEON_PROJECT_ID: ${{ secrets.NEON_PROJECT_ID }}\n          NEON_API_KEY: ${{ secrets.NEON_API_KEY }}\n          NEON_BRANCH_NAME: ${{ env.BRANCH_NAME }}\n          TEST_USER_EMAIL: ${{ secrets.TEST_USER_EMAIL }}\n          TEST_USER_PASSWORD: ${{ secrets.TEST_USER_PASSWORD }}\n          NEXT_PUBLIC_STACK_PROJECT_ID: ${{ secrets.NEXT_PUBLIC_STACK_PROJECT_ID }}\n          NEXT_PUBLIC_STACK_PUBLISHABLE_CLIENT_KEY: ${{ secrets.NEXT_PUBLIC_STACK_PUBLISHABLE_CLIENT_KEY }}\n          STACK_SECRET_SERVER_KEY: ${{ secrets.STACK_SECRET_SERVER_KEY }}\n          UPSTASH_REDIS_REST_URL: ${{ secrets.UPSTASH_REDIS_REST_URL }}\n          UPSTASH_REDIS_REST_TOKEN: ${{ secrets.UPSTASH_REDIS_REST_TOKEN }}\n          BLOB_READ_WRITE_TOKEN: ${{ secrets.BLOB_READ_WRITE_TOKEN }}\n          BLOB_BASE_URL: ${{ secrets.BLOB_BASE_URL }}\n          RESEND_API_KEY: ${{ secrets.RESEND_API_KEY }}\n\n      - name: Delete Neon Branch\n        if: always()\n        uses: neondatabase/delete-branch-action@v3\n        with:\n          project_id: ${{ secrets.NEON_PROJECT_ID }}\n          branch: ${{ env.BRANCH_NAME }}\n          api_key: ${{ secrets.NEON_API_KEY }}\n```\n\n- This is fairly sophisticated. For reference,[ here's the one that deploys this course website][simple-action] to GitHub pages. Basically build and ship.\n- In this one, we run it whenever new commits land in main and we also run it on PRs automatically.\n- We then split the run into four parts so they can be run on three separate machines and go fast: type check with TypeScript, lint/format with Biome, unit test with Vitest, and E2E test with Playwright.\n- In each one we set up Node.js, we install deps, and we run the testing scripts. For Playwright, we do need to build the server as well so it can actually run and have Playwright test it.\n- We pass in the variables (that we'll set up shortly in GitHub) so that they can be used for testing purposes. These will come from secret variables we set up.\n- We could go through and split hairs about what is a variable and what is a secret, but I'm just making everything a secret.\n\nLet's go to the repo, to settings, to secrets and variables, and add all of our _test_ variables into here. You have to do it one-by-one which is a bit of a pain, but once you've done that, you're ready to run your CI checks! You may find you need to fix some Biome errors. But now we can't merge anything that doesn't pass type checking, linting, formatting, unit tests, and E2E tests. That's a good first step of assurance that bad stuff isn't going out.\n\nOkay, now that you have and it's committed, push it to the repo and you should see it start running on every commit and PR. E2E tests take quite a bit longer to run because they set up Chromium every time.\n\nHooray! Code quality!\n\n[simple-action]: https://github.com/btholt/build-a-fullstack-nextjs-app-v4/blob/main/.github/workflows/next.yaml\n","slug":"continuous-integration","title":"Continuous Integration","section":"DevOps","icon":"cogs","filePath":"/home/runner/work/build-a-fullstack-nextjs-app-v4/build-a-fullstack-nextjs-app-v4/lessons/09-devops/D-continuous-integration.md","nextSlug":"/lessons/conclusion/what-more-you-can-do","prevSlug":"/lessons/devops/continuous-delivery"}},"__N_SSG":true}