<!DOCTYPE html><html><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="width=device-width" data-next-head=""/><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png" data-next-head=""/><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png" data-next-head=""/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png" data-next-head=""/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png" data-next-head=""/><link rel="icon" type="image/x-icon" href="/images/favicon.ico" data-next-head=""/><title data-next-head="">Continuous Integration – Build a Fullstack Next.js App, v4</title><meta name="description" content="Build a production-ready team wiki from scratch using Next.js, TypeScript, and modern SaaS tools. Master authentication, database integration, AI features, and deployment patterns." data-next-head=""/><meta name="keywords" content="Next.js,fullstack,React,TypeScript,authentication,database,Postgres,Vercel,deployment,SaaS,AI integration,modern web development" data-next-head=""/><meta name="og:description" content="Build a production-ready team wiki from scratch using Next.js, TypeScript, and modern SaaS tools. Master authentication, database integration, AI features, and deployment patterns." data-next-head=""/><meta name="og:title" content="Continuous Integration – Build a Fullstack Next.js App, v4" data-next-head=""/><meta name="og:image" content="/images/social-share-cover.jpg" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><link data-next-font="size-adjust" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/de2ef606dd4d4a67.css" as="style"/><link rel="stylesheet" href="/_next/static/css/de2ef606dd4d4a67.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-b66ed8ba6f029a99.js" defer=""></script><script src="/_next/static/chunks/framework-b1e5f14688f9ffe6.js" defer=""></script><script src="/_next/static/chunks/main-953f8078176d6f7b.js" defer=""></script><script src="/_next/static/chunks/pages/_app-04cfcdd17f247960.js" defer=""></script><script src="/_next/static/chunks/pages/lessons/%5Bsection%5D/%5Bslug%5D-e3f3acd10ab352ae.js" defer=""></script><script src="/_next/static/XOcKuB9gZ84DgFGtHvLgN/_buildManifest.js" defer=""></script><script src="/_next/static/XOcKuB9gZ84DgFGtHvLgN/_ssgManifest.js" defer=""></script></head><body><script async="" defer="" src="https://a.holt.courses/latest.js"></script><div id="__next"><div class="remix-app"><header class="navbar"><h1 class="navbar-brand"><a href="/">Build a Fullstack Next.js App, v4</a></h1><div class="navbar-info"><a href="https://frontendmasters.com/workshops/fullstack-app-next-v4/" class="cta-btn">Watch on Frontend Masters</a></div></header><div class="content-container"><div class="main"><div class="lesson-container"><div class="lesson"><div class="lesson-content"><p>We can deliver our code to production, and we can monitor it once it&#39;s there, but how do we ensure code quality and prevent issues before we even have them?</p>
<p>Continuous Integration, the CI portion of CI/CD.</p>
<p>We are going to use GitHub Actions for this (as it&#39;s a great platform for most use cases) but there&#39;s a trillion providers out there that do this.</p>
<p>I&#39;ve already put this file in there in your repo, but I&#39;m going to code this up with you as it&#39;s a doozy. A lot CI can be pretty simple, but this full stack enterprise, let&#39;s throw the kitchen sink at it.</p>
<pre><code class="hljs language-yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">CI</span>

<span class="hljs-attr">on:</span>
  <span class="hljs-attr">push:</span>
    <span class="hljs-attr">branches:</span> [<span class="hljs-string">main</span>]
  <span class="hljs-attr">pull_request:</span>
    <span class="hljs-attr">branches:</span> [<span class="hljs-string">main</span>]

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">lint-and-format:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">Lint</span> <span class="hljs-string">and</span> <span class="hljs-string">Format</span> <span class="hljs-string">Check</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>

    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Checkout</span> <span class="hljs-string">code</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v4</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setup</span> <span class="hljs-string">Node.js</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v4</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">node-version:</span> <span class="hljs-string">&quot;22&quot;</span>
          <span class="hljs-attr">cache:</span> <span class="hljs-string">&quot;npm&quot;</span>
          <span class="hljs-attr">cache-dependency-path:</span> <span class="hljs-string">package-lock.json</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">dependencies</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">ci</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">Biome</span> <span class="hljs-string">check</span> <span class="hljs-string">(lint</span> <span class="hljs-string">+</span> <span class="hljs-string">format)</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">run</span> <span class="hljs-string">lint</span>

  <span class="hljs-attr">unit-tests:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">Unit</span> <span class="hljs-string">Tests</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>

    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Checkout</span> <span class="hljs-string">code</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v4</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setup</span> <span class="hljs-string">Node.js</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v4</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">node-version:</span> <span class="hljs-string">&quot;22&quot;</span>
          <span class="hljs-attr">cache:</span> <span class="hljs-string">&quot;npm&quot;</span>
          <span class="hljs-attr">cache-dependency-path:</span> <span class="hljs-string">package-lock.json</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Get</span> <span class="hljs-string">Neon</span> <span class="hljs-string">branch</span> <span class="hljs-string">name</span>
        <span class="hljs-attr">id:</span> <span class="hljs-string">neon-branch-name</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">echo</span> <span class="hljs-string">&quot;BRANCH_NAME=unit-$<span class="hljs-template-variable">{{ github.run_id }}</span>&quot;</span> <span class="hljs-string">&gt;&gt;</span> <span class="hljs-string">&quot;$GITHUB_ENV&quot;</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Get</span> <span class="hljs-string">branch</span> <span class="hljs-string">expiration</span> <span class="hljs-string">date</span> <span class="hljs-string">as</span> <span class="hljs-string">an</span> <span class="hljs-string">env</span> <span class="hljs-string">variable</span> <span class="hljs-string">(2</span> <span class="hljs-string">weeks</span> <span class="hljs-string">from</span> <span class="hljs-string">now)</span>
        <span class="hljs-attr">id:</span> <span class="hljs-string">get-expiration-date</span>
        <span class="hljs-attr">run:</span>
          <span class="hljs-string">echo</span> <span class="hljs-string">&quot;EXPIRES_AT=$(date -u --date &#x27;+14 days&#x27; +&#x27;%Y-%m-%dT%H:%M:%SZ&#x27;)&quot;</span>
          <span class="hljs-string">&gt;&gt;</span> <span class="hljs-string">&quot;$GITHUB_ENV&quot;</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Create</span> <span class="hljs-string">Neon</span> <span class="hljs-string">Branch</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">neondatabase/create-branch-action@v6</span>
        <span class="hljs-attr">id:</span> <span class="hljs-string">create-neon-branch</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">project_id:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.NEON_PROJECT_ID</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">branch_name:</span> <span class="hljs-string">${{</span> <span class="hljs-string">env.BRANCH_NAME</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">api_key:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.NEON_API_KEY</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">expires_at:</span> <span class="hljs-string">${{</span> <span class="hljs-string">env.EXPIRES_AT</span> <span class="hljs-string">}}</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">dependencies</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">ci</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">unit</span> <span class="hljs-string">tests</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">run</span> <span class="hljs-string">test</span>
        <span class="hljs-attr">env:</span>
          <span class="hljs-attr">DATABASE_URL:</span> <span class="hljs-string">${{</span> <span class="hljs-string">steps.create-neon-branch.outputs.db_url</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">NODE_ENV:</span> <span class="hljs-string">test</span>
          <span class="hljs-attr">NEON_PROJECT_ID:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.NEON_PROJECT_ID</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">NEON_API_KEY:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.NEON_API_KEY</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">NEON_BRANCH_NAME:</span> <span class="hljs-string">${{</span> <span class="hljs-string">env.BRANCH_NAME</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">TEST_USER_EMAIL:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.TEST_USER_EMAIL</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">TEST_USER_PASSWORD:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.TEST_USER_PASSWORD</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">NEXT_PUBLIC_STACK_PROJECT_ID:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.NEXT_PUBLIC_STACK_PROJECT_ID</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">NEXT_PUBLIC_STACK_PUBLISHABLE_CLIENT_KEY:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.NEXT_PUBLIC_STACK_PUBLISHABLE_CLIENT_KEY</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">STACK_SECRET_SERVER_KEY:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.STACK_SECRET_SERVER_KEY</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">UPSTASH_REDIS_REST_URL:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.UPSTASH_REDIS_REST_URL</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">UPSTASH_REDIS_REST_TOKEN:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.UPSTASH_REDIS_REST_TOKEN</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">BLOB_READ_WRITE_TOKEN:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.BLOB_READ_WRITE_TOKEN</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">BLOB_BASE_URL:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.BLOB_BASE_URL</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">RESEND_API_KEY:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.RESEND_API_KEY</span> <span class="hljs-string">}}</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Delete</span> <span class="hljs-string">Neon</span> <span class="hljs-string">Branch</span>
        <span class="hljs-attr">if:</span> <span class="hljs-string">always()</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">neondatabase/delete-branch-action@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">project_id:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.NEON_PROJECT_ID</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">branch:</span> <span class="hljs-string">${{</span> <span class="hljs-string">env.BRANCH_NAME</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">api_key:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.NEON_API_KEY</span> <span class="hljs-string">}}</span>

  <span class="hljs-attr">e2e-tests:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">E2E</span> <span class="hljs-string">Tests</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>

    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Checkout</span> <span class="hljs-string">code</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v4</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setup</span> <span class="hljs-string">Node.js</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v4</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">node-version:</span> <span class="hljs-string">&quot;22&quot;</span>
          <span class="hljs-attr">cache:</span> <span class="hljs-string">&quot;npm&quot;</span>
          <span class="hljs-attr">cache-dependency-path:</span> <span class="hljs-string">package-lock.json</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Get</span> <span class="hljs-string">Neon</span> <span class="hljs-string">branch</span> <span class="hljs-string">name</span>
        <span class="hljs-attr">id:</span> <span class="hljs-string">neon-branch-name</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">echo</span> <span class="hljs-string">&quot;BRANCH_NAME=e2e-$<span class="hljs-template-variable">{{ github.run_id }}</span>&quot;</span> <span class="hljs-string">&gt;&gt;</span> <span class="hljs-string">&quot;$GITHUB_ENV&quot;</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Get</span> <span class="hljs-string">branch</span> <span class="hljs-string">expiration</span> <span class="hljs-string">date</span> <span class="hljs-string">as</span> <span class="hljs-string">an</span> <span class="hljs-string">env</span> <span class="hljs-string">variable</span> <span class="hljs-string">(2</span> <span class="hljs-string">weeks</span> <span class="hljs-string">from</span> <span class="hljs-string">now)</span>
        <span class="hljs-attr">id:</span> <span class="hljs-string">get-expiration-date</span>
        <span class="hljs-attr">run:</span>
          <span class="hljs-string">echo</span> <span class="hljs-string">&quot;EXPIRES_AT=$(date -u --date &#x27;+14 days&#x27; +&#x27;%Y-%m-%dT%H:%M:%SZ&#x27;)&quot;</span>
          <span class="hljs-string">&gt;&gt;</span> <span class="hljs-string">&quot;$GITHUB_ENV&quot;</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Create</span> <span class="hljs-string">Neon</span> <span class="hljs-string">Branch</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">neondatabase/create-branch-action@v6</span>
        <span class="hljs-attr">id:</span> <span class="hljs-string">create-neon-branch</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">project_id:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.NEON_PROJECT_ID</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">branch_name:</span> <span class="hljs-string">${{</span> <span class="hljs-string">env.BRANCH_NAME</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">api_key:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.NEON_API_KEY</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">expires_at:</span> <span class="hljs-string">${{</span> <span class="hljs-string">env.EXPIRES_AT</span> <span class="hljs-string">}}</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">dependencies</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">ci</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">Playwright</span> <span class="hljs-string">browsers</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">npx</span> <span class="hljs-string">playwright</span> <span class="hljs-string">install</span> <span class="hljs-string">--with-deps</span> <span class="hljs-string">chromium</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">E2E</span> <span class="hljs-string">tests</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">run</span> <span class="hljs-string">test:e2e:ci</span>
        <span class="hljs-attr">env:</span>
          <span class="hljs-attr">NODE_ENV:</span> <span class="hljs-string">test</span>
          <span class="hljs-attr">DATABASE_URL:</span> <span class="hljs-string">${{</span> <span class="hljs-string">steps.create-neon-branch.outputs.db_url</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">NEON_PROJECT_ID:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.NEON_PROJECT_ID</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">NEON_API_KEY:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.NEON_API_KEY</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">NEON_BRANCH_NAME:</span> <span class="hljs-string">${{</span> <span class="hljs-string">env.BRANCH_NAME</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">TEST_USER_EMAIL:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.TEST_USER_EMAIL</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">TEST_USER_PASSWORD:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.TEST_USER_PASSWORD</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">NEXT_PUBLIC_STACK_PROJECT_ID:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.NEXT_PUBLIC_STACK_PROJECT_ID</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">NEXT_PUBLIC_STACK_PUBLISHABLE_CLIENT_KEY:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.NEXT_PUBLIC_STACK_PUBLISHABLE_CLIENT_KEY</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">STACK_SECRET_SERVER_KEY:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.STACK_SECRET_SERVER_KEY</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">UPSTASH_REDIS_REST_URL:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.UPSTASH_REDIS_REST_URL</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">UPSTASH_REDIS_REST_TOKEN:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.UPSTASH_REDIS_REST_TOKEN</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">BLOB_READ_WRITE_TOKEN:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.BLOB_READ_WRITE_TOKEN</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">BLOB_BASE_URL:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.BLOB_BASE_URL</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">RESEND_API_KEY:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.RESEND_API_KEY</span> <span class="hljs-string">}}</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Delete</span> <span class="hljs-string">Neon</span> <span class="hljs-string">Branch</span>
        <span class="hljs-attr">if:</span> <span class="hljs-string">always()</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">neondatabase/delete-branch-action@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">project_id:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.NEON_PROJECT_ID</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">branch:</span> <span class="hljs-string">${{</span> <span class="hljs-string">env.BRANCH_NAME</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">api_key:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.NEON_API_KEY</span> <span class="hljs-string">}}</span>
</code></pre><ul>
<li>This is fairly sophisticated. For reference,<a href="https://github.com/btholt/build-a-fullstack-nextjs-app-v4/blob/main/.github/workflows/next.yaml"> here&#39;s the one that deploys this course website</a> to GitHub pages. Basically build and ship.</li>
<li>In this one, we run it whenever new commits land in main and we also run it on PRs automatically.</li>
<li>We then split the run into four parts so they can be run on three separate machines and go fast: type check with TypeScript, lint/format with Biome, unit test with Vitest, and E2E test with Playwright.</li>
<li>In each one we set up Node.js, we install deps, and we run the testing scripts. For Playwright, we do need to build the server as well so it can actually run and have Playwright test it.</li>
<li>We pass in the variables (that we&#39;ll set up shortly in GitHub) so that they can be used for testing purposes. These will come from secret variables we set up.</li>
<li>We could go through and split hairs about what is a variable and what is a secret, but I&#39;m just making everything a secret.</li>
</ul>
<p>Let&#39;s go to the repo, to settings, to secrets and variables, and add all of our <em>test</em> variables into here. You have to do it one-by-one which is a bit of a pain, but once you&#39;ve done that, you&#39;re ready to run your CI checks! You may find you need to fix some Biome errors. But now we can&#39;t merge anything that doesn&#39;t pass type checking, linting, formatting, unit tests, and E2E tests. That&#39;s a good first step of assurance that bad stuff isn&#39;t going out.</p>
<p>Okay, now that you have and it&#39;s committed, push it to the repo and you should see it start running on every commit and PR. E2E tests take quite a bit longer to run because they set up Chromium every time.</p>
<p>Hooray! Code quality!</p>
</div><div class="lesson-links"><a href="/lessons/devops/continuous-delivery" class="prev">← Previous</a><a href="/lessons/conclusion/what-more-you-can-do" class="next">Next →</a></div></div><div class="details-bg"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="154" height="154" viewBox="0 0 154 154"><defs><clipPath id="clip-path"><rect id="Rectangle_2238" data-name="Rectangle 2238" width="154" height="154" transform="translate(9467 350)" fill="#fff" stroke="#707070" stroke-width="1"></rect></clipPath><clipPath id="clip-corner-image-active"><rect width="154" height="154"></rect></clipPath></defs><g id="corner-image-active" clip-path="url(#clip-corner-image-active)"><g id="Corner-image-active-2" data-name="Corner-image-active" transform="translate(-9467 -350)" clip-path="url(#clip-path)"><path id="Subtraction_34" data-name="Subtraction 34" d="M-3857.365,1740.766h0l-7.07-7.07,12.89-12.89v14.142l-5.818,5.818Zm-14.142-14.142h0l-7.071-7.07,27.033-27.033v14.143l-19.96,19.96Zm-14.143-14.143h0l-7.07-7.069,41.175-41.175v14.142Zm-14.142-14.142h0l-7.07-7.069,55.317-55.317v14.142Zm-14.142-14.142h0l-7.07-7.069,69.459-69.459v14.142Zm-14.142-14.142h0l-7.07-7.069,76.739-76.739h6.862v7.28Zm-14.143-14.143h0l-7.07-7.069,62.6-62.6h14.142Zm-14.142-14.142h0l-7.07-7.069,48.454-48.454h14.142Zm-14.142-14.142h0l-7.07-7.069,34.312-34.312h14.142Zm-14.142-14.142h0l-7.07-7.069,20.17-20.17h14.142Zm-14.142-14.142h0l-7.071-7.071,6.027-6.027h14.144l-13.1,13.1Zm367.24-56.114v-.909l.455.455-.453.453Z" transform="translate(13472.546 -1236.766)" fill="var(--corner-fill)"></path></g></g></svg></div></div></div></div><noscript><img src="https://a.holt.courses/noscript.gif" alt="" referrerPolicy="no-referrer-when-downgrade"/></noscript><footer class="footer"><ul class="socials"><li class="social"><a href="https://twitter.com/holtbt"><svg fill="none" height="100%" width="32" xmlns="http://www.w3.org/2000/svg" viewBox="0.254 0.25 500 451.95400000000006"><path d="M394.033.25h76.67L303.202 191.693l197.052 260.511h-154.29L225.118 294.205 86.844 452.204H10.127l179.16-204.77L.254.25H158.46l109.234 144.417zm-26.908 406.063h42.483L135.377 43.73h-45.59z" fill="var(--footer-icons)"></path></svg></a></li><li class="social"><a href="https://bsky.app/profile/brianholt.me"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -3.268 64 68.414" width="38" height="100%"><path fill="var(--footer-icons)" d="M13.873 3.805C21.21 9.332 29.103 20.537 32 26.55v15.882c0-.338-.13.044-.41.867-1.512 4.456-7.418 21.847-20.923 7.944-7.111-7.32-3.819-14.64 9.125-16.85-7.405 1.264-15.73-.825-18.014-9.015C1.12 23.022 0 8.51 0 6.55 0-3.268 8.579-.182 13.873 3.805zm36.254 0C42.79 9.332 34.897 20.537 32 26.55v15.882c0-.338.13.044.41.867 1.512 4.456 7.418 21.847 20.923 7.944 7.111-7.32 3.819-14.64-9.125-16.85 7.405 1.264 15.73-.825 18.014-9.015C62.88 23.022 64 8.51 64 6.55c0-9.818-8.578-6.732-13.873-2.745z"></path></svg></a></li><li class="social"><a href="https://github.com/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-github-social"><rect width="32" height="32"></rect></clipPath></defs><g id="github-social" clip-path="url(#clip-github-social)"><g id="Group_272" data-name="Group 272" transform="translate(13522.5 -6994)"><path id="Subtraction_33" data-name="Subtraction 33" d="M-24967.5,8041a15.9,15.9,0,0,1-11.312-4.688A15.893,15.893,0,0,1-24983.5,8025a15.893,15.893,0,0,1,4.689-11.315A15.894,15.894,0,0,1-24967.5,8009a15.894,15.894,0,0,1,11.313,4.686A15.893,15.893,0,0,1-24951.5,8025a15.893,15.893,0,0,1-4.689,11.313A15.9,15.9,0,0,1-24967.5,8041Zm-3.781-4.571h0v3.918h7.895v-6.665a1.836,1.836,0,0,0-1.2-1.718c5.1-.617,7.467-2.975,7.467-7.424a7.176,7.176,0,0,0-1.637-4.728,6.74,6.74,0,0,0,.275-1.812,4.34,4.34,0,0,0-.52-2.452.574.574,0,0,0-.359-.1c-1.061,0-3.465,1.411-3.936,1.694a16.644,16.644,0,0,0-4.2-.489,16.379,16.379,0,0,0-3.969.445c-.846-.5-2.91-1.649-3.859-1.649a.566.566,0,0,0-.354.095,4.3,4.3,0,0,0-.521,2.452,6.7,6.7,0,0,0,.244,1.718,7.346,7.346,0,0,0-1.6,4.822,7.263,7.263,0,0,0,1.533,4.985c1.193,1.359,3.115,2.165,5.871,2.464a1.826,1.826,0,0,0-1.129,1.693v.5h0l-.006,0a7.121,7.121,0,0,1-2.033.363,2.608,2.608,0,0,1-.965-.158,4.438,4.438,0,0,1-1.836-1.881,2.361,2.361,0,0,0-1.248-1.091,3.472,3.472,0,0,0-1.217-.3.584.584,0,0,0-.545.224.282.282,0,0,0,.027.367,1.875,1.875,0,0,0,.447.307,4.732,4.732,0,0,1,.561.355,10.726,10.726,0,0,1,1.682,2.755c.043.092.078.163.105.217a3.876,3.876,0,0,0,2.42,1.185,6.036,6.036,0,0,0,.607.025c.875,0,1.988-.124,2-.125Z" transform="translate(11461 -1015)" fill="var(--footer-icons)"></path><g id="Ellipse_670" data-name="Ellipse 670" transform="translate(-13522.5 6994)" fill="none" stroke="var(--footer-icons)" stroke-width="1"><circle cx="16" cy="16" r="16" stroke="none"></circle><circle cx="16" cy="16" r="15.5" fill="none"></circle></g></g></g></svg></a></li><li class="social"><a href="https://linkedin.com/in/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-linkedin-social"><rect width="32" height="32"></rect></clipPath></defs><g id="linkedin-social" clip-path="url(#clip-linkedin-social)"><g id="Group_270" data-name="Group 270" transform="translate(-86.349 -633.073)"><path id="Path_375" data-name="Path 375" d="M115.789,633.073a2.324,2.324,0,0,1,1.682.676,2.194,2.194,0,0,1,.695,1.627V662.8a2.131,2.131,0,0,1-.695,1.609,2.314,2.314,0,0,1-1.646.659H88.69a2.307,2.307,0,0,1-1.646-.659,2.128,2.128,0,0,1-.695-1.609V635.376a2.19,2.19,0,0,1,.695-1.627,2.322,2.322,0,0,1,1.682-.676h27.063Zm-20.224,9.672a2.561,2.561,0,0,0,0-3.584,2.658,2.658,0,0,0-1.938-.712,2.724,2.724,0,0,0-1.957.712,2.371,2.371,0,0,0-.75,1.792,2.4,2.4,0,0,0,.731,1.792,2.605,2.605,0,0,0,1.9.713h.037A2.7,2.7,0,0,0,95.565,642.745ZM96,645.434H91.213V659.88H96Zm17.3,6.144a7.007,7.007,0,0,0-1.573-4.9,5.68,5.68,0,0,0-6.839-.769,5.663,5.663,0,0,0-1.426,1.573v-2.048H98.674q.036.841,0,7.717v6.728h4.791V651.8a3.592,3.592,0,0,1,.146-1.17,2.913,2.913,0,0,1,.878-1.206,2.429,2.429,0,0,1,1.609-.549,2.108,2.108,0,0,1,1.865.914,4.265,4.265,0,0,1,.549,2.341v7.752H113.3Z" fill="var(--footer-icons)"></path></g></g></svg></a></li><li class="social"><div class="terms"><p>Content Licensed Under CC-BY-NC-4.0</p><p>Code Samples and Exercises Licensed Under Apache 2.0</p><p>Site Designed by<!-- --> <a href="https://www.alexdanielson.com/">Alex Danielson</a></p></div></li></ul><div class="theme-icons"><link id="highlight-theme-light" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.8.0/styles/a11y-light.min.css"/><link id="highlight-theme-dark" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.8.0/styles/a11y-dark.min.css" disabled=""/><button aria-label="Activate dark mode" title="Activate dark mode" class="theme-toggle"><svg xmlns="http://www.w3.org/2000/svg" width="36px" height="100%" viewBox="0 -960 960 960" fill="var(--text-footer)" role="img"><title>Dark Mode Icon</title><path d="M480-120q-150 0-255-105T120-480q0-150 105-255t255-105q14 0 27.5 1t26.5 3q-41 29-65.5 75.5T444-660q0 90 63 153t153 63q55 0 101-24.5t75-65.5q2 13 3 26.5t1 27.5q0 150-105 255T480-120Zm0-80q88 0 158-48.5T740-375q-20 5-40 8t-40 3q-123 0-209.5-86.5T364-660q0-20 3-40t8-40q-78 32-126.5 102T200-480q0 116 82 198t198 82Z"></path></svg></button></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"attributes":{},"html":"\u003cp\u003eWe can deliver our code to production, and we can monitor it once it\u0026#39;s there, but how do we ensure code quality and prevent issues before we even have them?\u003c/p\u003e\n\u003cp\u003eContinuous Integration, the CI portion of CI/CD.\u003c/p\u003e\n\u003cp\u003eWe are going to use GitHub Actions for this (as it\u0026#39;s a great platform for most use cases) but there\u0026#39;s a trillion providers out there that do this.\u003c/p\u003e\n\u003cp\u003eI\u0026#39;ve already put this file in there in your repo, but I\u0026#39;m going to code this up with you as it\u0026#39;s a doozy. A lot CI can be pretty simple, but this full stack enterprise, let\u0026#39;s throw the kitchen sink at it.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-yaml\"\u003e\u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eCI\u003c/span\u003e\n\n\u003cspan class=\"hljs-attr\"\u003eon:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003epush:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ebranches:\u003c/span\u003e [\u003cspan class=\"hljs-string\"\u003emain\u003c/span\u003e]\n  \u003cspan class=\"hljs-attr\"\u003epull_request:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ebranches:\u003c/span\u003e [\u003cspan class=\"hljs-string\"\u003emain\u003c/span\u003e]\n\n\u003cspan class=\"hljs-attr\"\u003ejobs:\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003elint-and-format:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eLint\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eand\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eFormat\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eCheck\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eruns-on:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eubuntu-latest\u003c/span\u003e\n\n    \u003cspan class=\"hljs-attr\"\u003esteps:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eCheckout\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ecode\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eactions/checkout@v4\u003c/span\u003e\n\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eSetup\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eNode.js\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eactions/setup-node@v4\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003ewith:\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003enode-version:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;22\u0026quot;\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003ecache:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;npm\u0026quot;\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003ecache-dependency-path:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epackage-lock.json\u003c/span\u003e\n\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eInstall\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edependencies\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003erun:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003enpm\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eci\u003c/span\u003e\n\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eRun\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eBiome\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003echeck\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e(lint\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e+\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eformat)\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003erun:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003enpm\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003erun\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003elint\u003c/span\u003e\n\n  \u003cspan class=\"hljs-attr\"\u003eunit-tests:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eUnit\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eTests\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eruns-on:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eubuntu-latest\u003c/span\u003e\n\n    \u003cspan class=\"hljs-attr\"\u003esteps:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eCheckout\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ecode\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eactions/checkout@v4\u003c/span\u003e\n\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eSetup\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eNode.js\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eactions/setup-node@v4\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003ewith:\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003enode-version:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;22\u0026quot;\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003ecache:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;npm\u0026quot;\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003ecache-dependency-path:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epackage-lock.json\u003c/span\u003e\n\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eGet\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eNeon\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ebranch\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ename\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003eid:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eneon-branch-name\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003erun:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;BRANCH_NAME=unit-$\u003cspan class=\"hljs-template-variable\"\u003e{{ github.run_id }}\u003c/span\u003e\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;$GITHUB_ENV\u0026quot;\u003c/span\u003e\n\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eGet\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ebranch\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eexpiration\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edate\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eas\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ean\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eenv\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003evariable\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e(2\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eweeks\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003enow)\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003eid:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eget-expiration-date\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003erun:\u003c/span\u003e\n          \u003cspan class=\"hljs-string\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;EXPIRES_AT=$(date -u --date \u0026#x27;+14 days\u0026#x27; +\u0026#x27;%Y-%m-%dT%H:%M:%SZ\u0026#x27;)\u0026quot;\u003c/span\u003e\n          \u003cspan class=\"hljs-string\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;$GITHUB_ENV\u0026quot;\u003c/span\u003e\n\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eCreate\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eNeon\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eBranch\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eneondatabase/create-branch-action@v6\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003eid:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ecreate-neon-branch\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003ewith:\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eproject_id:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.NEON_PROJECT_ID\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003ebranch_name:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eenv.BRANCH_NAME\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eapi_key:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.NEON_API_KEY\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eexpires_at:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eenv.EXPIRES_AT\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eInstall\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edependencies\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003erun:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003enpm\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eci\u003c/span\u003e\n\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eRun\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eunit\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etests\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003erun:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003enpm\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003erun\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etest\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003eenv:\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eDATABASE_URL:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esteps.create-neon-branch.outputs.db_url\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eNODE_ENV:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etest\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eNEON_PROJECT_ID:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.NEON_PROJECT_ID\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eNEON_API_KEY:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.NEON_API_KEY\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eNEON_BRANCH_NAME:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eenv.BRANCH_NAME\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eTEST_USER_EMAIL:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.TEST_USER_EMAIL\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eTEST_USER_PASSWORD:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.TEST_USER_PASSWORD\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eNEXT_PUBLIC_STACK_PROJECT_ID:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.NEXT_PUBLIC_STACK_PROJECT_ID\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eNEXT_PUBLIC_STACK_PUBLISHABLE_CLIENT_KEY:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.NEXT_PUBLIC_STACK_PUBLISHABLE_CLIENT_KEY\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eSTACK_SECRET_SERVER_KEY:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.STACK_SECRET_SERVER_KEY\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eUPSTASH_REDIS_REST_URL:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.UPSTASH_REDIS_REST_URL\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eUPSTASH_REDIS_REST_TOKEN:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.UPSTASH_REDIS_REST_TOKEN\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eBLOB_READ_WRITE_TOKEN:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.BLOB_READ_WRITE_TOKEN\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eBLOB_BASE_URL:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.BLOB_BASE_URL\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eRESEND_API_KEY:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.RESEND_API_KEY\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eDelete\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eNeon\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eBranch\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003eif:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ealways()\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eneondatabase/delete-branch-action@v3\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003ewith:\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eproject_id:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.NEON_PROJECT_ID\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003ebranch:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eenv.BRANCH_NAME\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eapi_key:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.NEON_API_KEY\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n\n  \u003cspan class=\"hljs-attr\"\u003ee2e-tests:\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eE2E\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eTests\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eruns-on:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eubuntu-latest\u003c/span\u003e\n\n    \u003cspan class=\"hljs-attr\"\u003esteps:\u003c/span\u003e\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eCheckout\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ecode\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eactions/checkout@v4\u003c/span\u003e\n\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eSetup\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eNode.js\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eactions/setup-node@v4\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003ewith:\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003enode-version:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;22\u0026quot;\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003ecache:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;npm\u0026quot;\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003ecache-dependency-path:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003epackage-lock.json\u003c/span\u003e\n\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eGet\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eNeon\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ebranch\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ename\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003eid:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eneon-branch-name\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003erun:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;BRANCH_NAME=e2e-$\u003cspan class=\"hljs-template-variable\"\u003e{{ github.run_id }}\u003c/span\u003e\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;$GITHUB_ENV\u0026quot;\u003c/span\u003e\n\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eGet\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ebranch\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eexpiration\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edate\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eas\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ean\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eenv\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003evariable\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e(2\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eweeks\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003enow)\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003eid:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eget-expiration-date\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003erun:\u003c/span\u003e\n          \u003cspan class=\"hljs-string\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;EXPIRES_AT=$(date -u --date \u0026#x27;+14 days\u0026#x27; +\u0026#x27;%Y-%m-%dT%H:%M:%SZ\u0026#x27;)\u0026quot;\u003c/span\u003e\n          \u003cspan class=\"hljs-string\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;$GITHUB_ENV\u0026quot;\u003c/span\u003e\n\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eCreate\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eNeon\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eBranch\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eneondatabase/create-branch-action@v6\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003eid:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ecreate-neon-branch\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003ewith:\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eproject_id:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.NEON_PROJECT_ID\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003ebranch_name:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eenv.BRANCH_NAME\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eapi_key:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.NEON_API_KEY\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eexpires_at:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eenv.EXPIRES_AT\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eInstall\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003edependencies\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003erun:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003enpm\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eci\u003c/span\u003e\n\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eInstall\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ePlaywright\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ebrowsers\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003erun:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003enpx\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eplaywright\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003einstall\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e--with-deps\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003echromium\u003c/span\u003e\n\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eRun\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eE2E\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etests\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003erun:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003enpm\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003erun\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etest:e2e:ci\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003eenv:\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eNODE_ENV:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003etest\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eDATABASE_URL:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esteps.create-neon-branch.outputs.db_url\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eNEON_PROJECT_ID:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.NEON_PROJECT_ID\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eNEON_API_KEY:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.NEON_API_KEY\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eNEON_BRANCH_NAME:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eenv.BRANCH_NAME\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eTEST_USER_EMAIL:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.TEST_USER_EMAIL\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eTEST_USER_PASSWORD:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.TEST_USER_PASSWORD\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eNEXT_PUBLIC_STACK_PROJECT_ID:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.NEXT_PUBLIC_STACK_PROJECT_ID\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eNEXT_PUBLIC_STACK_PUBLISHABLE_CLIENT_KEY:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.NEXT_PUBLIC_STACK_PUBLISHABLE_CLIENT_KEY\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eSTACK_SECRET_SERVER_KEY:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.STACK_SECRET_SERVER_KEY\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eUPSTASH_REDIS_REST_URL:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.UPSTASH_REDIS_REST_URL\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eUPSTASH_REDIS_REST_TOKEN:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.UPSTASH_REDIS_REST_TOKEN\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eBLOB_READ_WRITE_TOKEN:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.BLOB_READ_WRITE_TOKEN\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eBLOB_BASE_URL:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.BLOB_BASE_URL\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eRESEND_API_KEY:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.RESEND_API_KEY\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n\n      \u003cspan class=\"hljs-bullet\"\u003e-\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eDelete\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eNeon\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eBranch\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003eif:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003ealways()\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003euses:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eneondatabase/delete-branch-action@v3\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003ewith:\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eproject_id:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.NEON_PROJECT_ID\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003ebranch:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003eenv.BRANCH_NAME\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n          \u003cspan class=\"hljs-attr\"\u003eapi_key:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e${{\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003esecrets.NEON_API_KEY\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e}}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003eThis is fairly sophisticated. For reference,\u003ca href=\"https://github.com/btholt/build-a-fullstack-nextjs-app-v4/blob/main/.github/workflows/next.yaml\"\u003e here\u0026#39;s the one that deploys this course website\u003c/a\u003e to GitHub pages. Basically build and ship.\u003c/li\u003e\n\u003cli\u003eIn this one, we run it whenever new commits land in main and we also run it on PRs automatically.\u003c/li\u003e\n\u003cli\u003eWe then split the run into four parts so they can be run on three separate machines and go fast: type check with TypeScript, lint/format with Biome, unit test with Vitest, and E2E test with Playwright.\u003c/li\u003e\n\u003cli\u003eIn each one we set up Node.js, we install deps, and we run the testing scripts. For Playwright, we do need to build the server as well so it can actually run and have Playwright test it.\u003c/li\u003e\n\u003cli\u003eWe pass in the variables (that we\u0026#39;ll set up shortly in GitHub) so that they can be used for testing purposes. These will come from secret variables we set up.\u003c/li\u003e\n\u003cli\u003eWe could go through and split hairs about what is a variable and what is a secret, but I\u0026#39;m just making everything a secret.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eLet\u0026#39;s go to the repo, to settings, to secrets and variables, and add all of our \u003cem\u003etest\u003c/em\u003e variables into here. You have to do it one-by-one which is a bit of a pain, but once you\u0026#39;ve done that, you\u0026#39;re ready to run your CI checks! You may find you need to fix some Biome errors. But now we can\u0026#39;t merge anything that doesn\u0026#39;t pass type checking, linting, formatting, unit tests, and E2E tests. That\u0026#39;s a good first step of assurance that bad stuff isn\u0026#39;t going out.\u003c/p\u003e\n\u003cp\u003eOkay, now that you have and it\u0026#39;s committed, push it to the repo and you should see it start running on every commit and PR. E2E tests take quite a bit longer to run because they set up Chromium every time.\u003c/p\u003e\n\u003cp\u003eHooray! Code quality!\u003c/p\u003e\n","markdown":"We can deliver our code to production, and we can monitor it once it's there, but how do we ensure code quality and prevent issues before we even have them?\n\nContinuous Integration, the CI portion of CI/CD.\n\nWe are going to use GitHub Actions for this (as it's a great platform for most use cases) but there's a trillion providers out there that do this.\n\nI've already put this file in there in your repo, but I'm going to code this up with you as it's a doozy. A lot CI can be pretty simple, but this full stack enterprise, let's throw the kitchen sink at it.\n\n```yaml\nname: CI\n\non:\n  push:\n    branches: [main]\n  pull_request:\n    branches: [main]\n\njobs:\n  lint-and-format:\n    name: Lint and Format Check\n    runs-on: ubuntu-latest\n\n    steps:\n      - name: Checkout code\n        uses: actions/checkout@v4\n\n      - name: Setup Node.js\n        uses: actions/setup-node@v4\n        with:\n          node-version: \"22\"\n          cache: \"npm\"\n          cache-dependency-path: package-lock.json\n\n      - name: Install dependencies\n        run: npm ci\n\n      - name: Run Biome check (lint + format)\n        run: npm run lint\n\n  unit-tests:\n    name: Unit Tests\n    runs-on: ubuntu-latest\n\n    steps:\n      - name: Checkout code\n        uses: actions/checkout@v4\n\n      - name: Setup Node.js\n        uses: actions/setup-node@v4\n        with:\n          node-version: \"22\"\n          cache: \"npm\"\n          cache-dependency-path: package-lock.json\n\n      - name: Get Neon branch name\n        id: neon-branch-name\n        run: echo \"BRANCH_NAME=unit-${{ github.run_id }}\" \u003e\u003e \"$GITHUB_ENV\"\n\n      - name: Get branch expiration date as an env variable (2 weeks from now)\n        id: get-expiration-date\n        run:\n          echo \"EXPIRES_AT=$(date -u --date '+14 days' +'%Y-%m-%dT%H:%M:%SZ')\"\n          \u003e\u003e \"$GITHUB_ENV\"\n\n      - name: Create Neon Branch\n        uses: neondatabase/create-branch-action@v6\n        id: create-neon-branch\n        with:\n          project_id: ${{ secrets.NEON_PROJECT_ID }}\n          branch_name: ${{ env.BRANCH_NAME }}\n          api_key: ${{ secrets.NEON_API_KEY }}\n          expires_at: ${{ env.EXPIRES_AT }}\n\n      - name: Install dependencies\n        run: npm ci\n\n      - name: Run unit tests\n        run: npm run test\n        env:\n          DATABASE_URL: ${{ steps.create-neon-branch.outputs.db_url }}\n          NODE_ENV: test\n          NEON_PROJECT_ID: ${{ secrets.NEON_PROJECT_ID }}\n          NEON_API_KEY: ${{ secrets.NEON_API_KEY }}\n          NEON_BRANCH_NAME: ${{ env.BRANCH_NAME }}\n          TEST_USER_EMAIL: ${{ secrets.TEST_USER_EMAIL }}\n          TEST_USER_PASSWORD: ${{ secrets.TEST_USER_PASSWORD }}\n          NEXT_PUBLIC_STACK_PROJECT_ID: ${{ secrets.NEXT_PUBLIC_STACK_PROJECT_ID }}\n          NEXT_PUBLIC_STACK_PUBLISHABLE_CLIENT_KEY: ${{ secrets.NEXT_PUBLIC_STACK_PUBLISHABLE_CLIENT_KEY }}\n          STACK_SECRET_SERVER_KEY: ${{ secrets.STACK_SECRET_SERVER_KEY }}\n          UPSTASH_REDIS_REST_URL: ${{ secrets.UPSTASH_REDIS_REST_URL }}\n          UPSTASH_REDIS_REST_TOKEN: ${{ secrets.UPSTASH_REDIS_REST_TOKEN }}\n          BLOB_READ_WRITE_TOKEN: ${{ secrets.BLOB_READ_WRITE_TOKEN }}\n          BLOB_BASE_URL: ${{ secrets.BLOB_BASE_URL }}\n          RESEND_API_KEY: ${{ secrets.RESEND_API_KEY }}\n\n      - name: Delete Neon Branch\n        if: always()\n        uses: neondatabase/delete-branch-action@v3\n        with:\n          project_id: ${{ secrets.NEON_PROJECT_ID }}\n          branch: ${{ env.BRANCH_NAME }}\n          api_key: ${{ secrets.NEON_API_KEY }}\n\n  e2e-tests:\n    name: E2E Tests\n    runs-on: ubuntu-latest\n\n    steps:\n      - name: Checkout code\n        uses: actions/checkout@v4\n\n      - name: Setup Node.js\n        uses: actions/setup-node@v4\n        with:\n          node-version: \"22\"\n          cache: \"npm\"\n          cache-dependency-path: package-lock.json\n\n      - name: Get Neon branch name\n        id: neon-branch-name\n        run: echo \"BRANCH_NAME=e2e-${{ github.run_id }}\" \u003e\u003e \"$GITHUB_ENV\"\n\n      - name: Get branch expiration date as an env variable (2 weeks from now)\n        id: get-expiration-date\n        run:\n          echo \"EXPIRES_AT=$(date -u --date '+14 days' +'%Y-%m-%dT%H:%M:%SZ')\"\n          \u003e\u003e \"$GITHUB_ENV\"\n\n      - name: Create Neon Branch\n        uses: neondatabase/create-branch-action@v6\n        id: create-neon-branch\n        with:\n          project_id: ${{ secrets.NEON_PROJECT_ID }}\n          branch_name: ${{ env.BRANCH_NAME }}\n          api_key: ${{ secrets.NEON_API_KEY }}\n          expires_at: ${{ env.EXPIRES_AT }}\n\n      - name: Install dependencies\n        run: npm ci\n\n      - name: Install Playwright browsers\n        run: npx playwright install --with-deps chromium\n\n      - name: Run E2E tests\n        run: npm run test:e2e:ci\n        env:\n          NODE_ENV: test\n          DATABASE_URL: ${{ steps.create-neon-branch.outputs.db_url }}\n          NEON_PROJECT_ID: ${{ secrets.NEON_PROJECT_ID }}\n          NEON_API_KEY: ${{ secrets.NEON_API_KEY }}\n          NEON_BRANCH_NAME: ${{ env.BRANCH_NAME }}\n          TEST_USER_EMAIL: ${{ secrets.TEST_USER_EMAIL }}\n          TEST_USER_PASSWORD: ${{ secrets.TEST_USER_PASSWORD }}\n          NEXT_PUBLIC_STACK_PROJECT_ID: ${{ secrets.NEXT_PUBLIC_STACK_PROJECT_ID }}\n          NEXT_PUBLIC_STACK_PUBLISHABLE_CLIENT_KEY: ${{ secrets.NEXT_PUBLIC_STACK_PUBLISHABLE_CLIENT_KEY }}\n          STACK_SECRET_SERVER_KEY: ${{ secrets.STACK_SECRET_SERVER_KEY }}\n          UPSTASH_REDIS_REST_URL: ${{ secrets.UPSTASH_REDIS_REST_URL }}\n          UPSTASH_REDIS_REST_TOKEN: ${{ secrets.UPSTASH_REDIS_REST_TOKEN }}\n          BLOB_READ_WRITE_TOKEN: ${{ secrets.BLOB_READ_WRITE_TOKEN }}\n          BLOB_BASE_URL: ${{ secrets.BLOB_BASE_URL }}\n          RESEND_API_KEY: ${{ secrets.RESEND_API_KEY }}\n\n      - name: Delete Neon Branch\n        if: always()\n        uses: neondatabase/delete-branch-action@v3\n        with:\n          project_id: ${{ secrets.NEON_PROJECT_ID }}\n          branch: ${{ env.BRANCH_NAME }}\n          api_key: ${{ secrets.NEON_API_KEY }}\n```\n\n- This is fairly sophisticated. For reference,[ here's the one that deploys this course website][simple-action] to GitHub pages. Basically build and ship.\n- In this one, we run it whenever new commits land in main and we also run it on PRs automatically.\n- We then split the run into four parts so they can be run on three separate machines and go fast: type check with TypeScript, lint/format with Biome, unit test with Vitest, and E2E test with Playwright.\n- In each one we set up Node.js, we install deps, and we run the testing scripts. For Playwright, we do need to build the server as well so it can actually run and have Playwright test it.\n- We pass in the variables (that we'll set up shortly in GitHub) so that they can be used for testing purposes. These will come from secret variables we set up.\n- We could go through and split hairs about what is a variable and what is a secret, but I'm just making everything a secret.\n\nLet's go to the repo, to settings, to secrets and variables, and add all of our _test_ variables into here. You have to do it one-by-one which is a bit of a pain, but once you've done that, you're ready to run your CI checks! You may find you need to fix some Biome errors. But now we can't merge anything that doesn't pass type checking, linting, formatting, unit tests, and E2E tests. That's a good first step of assurance that bad stuff isn't going out.\n\nOkay, now that you have and it's committed, push it to the repo and you should see it start running on every commit and PR. E2E tests take quite a bit longer to run because they set up Chromium every time.\n\nHooray! Code quality!\n\n[simple-action]: https://github.com/btholt/build-a-fullstack-nextjs-app-v4/blob/main/.github/workflows/next.yaml\n","slug":"continuous-integration","title":"Continuous Integration","section":"DevOps","icon":"cogs","filePath":"/home/runner/work/build-a-fullstack-nextjs-app-v4/build-a-fullstack-nextjs-app-v4/lessons/09-devops/D-continuous-integration.md","nextSlug":"/lessons/conclusion/what-more-you-can-do","prevSlug":"/lessons/devops/continuous-delivery"}},"__N_SSG":true},"page":"/lessons/[section]/[slug]","query":{"section":"devops","slug":"continuous-integration"},"buildId":"XOcKuB9gZ84DgFGtHvLgN","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>