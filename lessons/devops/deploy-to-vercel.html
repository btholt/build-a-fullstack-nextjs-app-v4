<!DOCTYPE html><html><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="width=device-width" data-next-head=""/><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png" data-next-head=""/><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png" data-next-head=""/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png" data-next-head=""/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png" data-next-head=""/><link rel="icon" type="image/x-icon" href="/images/favicon.ico" data-next-head=""/><title data-next-head="">Deploy to Vercel ‚Äì Build a Fullstack Next.js App, v4</title><meta name="description" content="Build a production-ready team wiki from scratch using Next.js, TypeScript, and modern SaaS tools. Master authentication, database integration, AI features, and deployment patterns." data-next-head=""/><meta name="keywords" content="Next.js,fullstack,React,TypeScript,authentication,database,Postgres,Vercel,deployment,SaaS,AI integration,modern web development" data-next-head=""/><meta name="og:description" content="Build a production-ready team wiki from scratch using Next.js, TypeScript, and modern SaaS tools. Master authentication, database integration, AI features, and deployment patterns." data-next-head=""/><meta name="og:title" content="Deploy to Vercel ‚Äì Build a Fullstack Next.js App, v4" data-next-head=""/><meta name="og:image" content="/images/social-share-cover.jpg" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><link data-next-font="size-adjust" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/de2ef606dd4d4a67.css" as="style"/><link rel="stylesheet" href="/_next/static/css/de2ef606dd4d4a67.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-b66ed8ba6f029a99.js" defer=""></script><script src="/_next/static/chunks/framework-b1e5f14688f9ffe6.js" defer=""></script><script src="/_next/static/chunks/main-03ed03852b4b217f.js" defer=""></script><script src="/_next/static/chunks/pages/_app-04cfcdd17f247960.js" defer=""></script><script src="/_next/static/chunks/pages/lessons/%5Bsection%5D/%5Bslug%5D-e3f3acd10ab352ae.js" defer=""></script><script src="/_next/static/3u4FnQFUETt3ux6gefDHe/_buildManifest.js" defer=""></script><script src="/_next/static/3u4FnQFUETt3ux6gefDHe/_ssgManifest.js" defer=""></script></head><body><script async="" defer="" src="https://a.holt.courses/latest.js"></script><div id="__next"><div class="remix-app"><header class="navbar"><h1 class="navbar-brand"><a href="/">Build a Fullstack Next.js App, v4</a></h1><div class="navbar-info"><a href="https://frontendmasters.com/workshops/fullstack-app-next-v4/" class="cta-btn">Watch on Frontend Masters</a></div></header><div class="content-container"><div class="main"><div class="lesson-container"><div class="lesson"><div class="lesson-content"><p>We are going to now do all the fun DevOps parts at the end: we are going to deploy, we are going to do CI/CD, and we are going to do observability and analytics.</p>
<p>There are so many ways to skin this cat so we are going to keep it pretty focused - Vercel offers nearly all of these services built-in and it works really well with Neon and Upstash, so we&#39;re just going to lean on that. If I was just getting started, this is what I&#39;d do - only reason I&#39;d something like a different observability platform or analytics is if I outgrew the perfectly adequate offering on Vercel.</p>
<p>Go to GitHub, create a new repo, and push your project into that repo. We&#39;re going to use this to deploy. Once you&#39;ve pushed your code to GitHub, go to Vercel.com and create a new project and connect your GitHub so we can add your repo to this project.</p>
<p>I took the liberty here of fixing some stuff up for deployment, namely adding a bunch of tests. This isn&#39;t a testing Next.js course and if you want to see my opinions on testing Next.js <a href="https://holt.fyi/intermediate-react">check out my Intermediate React course</a> - I go into plenty depth there. So instead I just want you to see what to do with the tests once you have them. I&#39;ve added some test specific code that you can look at if you want (for example it doesn&#39;t run the AI summaries in test because it&#39;d waste a lot of tokens)</p>
<blockquote>
<p>üèÅ This is the <a href="https://github.com/btholt/fullstack-next-wiki/tree/main/09-with-tests">09-with-tests</a> checkpoint. Open that folder in the sample project repo to go to where we are as of right here. This is the final version of the project and what we&#39;ll use to deploy.</p>
</blockquote>
<p>Another note - these days I mostly vibe code my tests - it&#39;s such a perfect use case for it.</p>
<p>In this repo, it&#39;ll now expect <em>two</em> sets of variables, if you want to. For the purposes of this course, feel free to just re-use your prod infra for test, but you&#39;ll see how to set up preview environments <em>and</em> prod environments.</p>
<p>Neon will automatically branch your database for you after we set up the integration so don&#39;t worry about those.</p>
<p>I personally set up a second Upstash, gave a fake Resend key for email, a second blob storage (which you can connect via the Storage tab but you do still need to add the <code>BLOB_BASE_URL</code> manually)</p>
<p>For Neon Auth, it won&#39;t work as-is. This is somewhat intentional - Neon Auth today just has one environment that doesn&#39;t branch, so your preview env would be hitting production, which you may or may not want. I&#39;d say you probably don&#39;t want that.</p>
<p>The way to work around this is to have a second Neon project that is just a Neon Auth project and you&#39;d regularly make a copy of your production Neon Auth to the project Neon Auth so it didn&#39;t fall out of sync (you&#39;d probably anonymize it too) - this isn&#39;t ideal and we&#39;re working on a better situation at Neon.</p>
<p>Alternatively you could have your preview environments automatically add their redirect URLs on creation and then have a job to clean them up when they go away. Messy still too.</p>
<p>Or, and hear me out here, you make the devs do it manually for each preview environment that needs it. Annoying, yes, but it also makes the devs handle it and it&#39;s not that burdensome to do - it&#39;s a couple of clicks in the Neon UI. We&#39;re going to skip doing this.</p>
<p>Lastly I just add the AI_GATEWAY_KEY for all envs - it won&#39;t get used in test because I turned it off in test.</p>
<blockquote>
<p>üö® Be sure to not upload every step (like my repo is) - instead just upload the project you&#39;re working on.</p>
</blockquote>
<p>We don&#39;t need to modify the build or anything because it all should just be default Next.js - Vercel is very much built for Next.js and vice-versa.</p>
<p>Once you&#39;ve done this, your app should be in prod! If you gave Vercel all the permissions it needed, it should also automatically set up all the Vercel preview deployment stuff with no additional work.</p>
<p>Let&#39;s hook up everything we need now</p>
<h2>Neon</h2>
<p>Let&#39;s make Neon work. Vercel and Neon have taken great care to make sure this works really well together so experience is as easy as</p>
<ul>
<li>Go to the project dashboard</li>
<li>Go to Settings</li>
<li>Go to Integrations</li>
<li>Browse Marketplace</li>
<li>Search for and Click on Neon. <a href="https://vercel.com/marketplace/neon">You can also go straight there from here</a></li>
<li>Click Install from the top right, click Link Existing Neon Account since that&#39;s what we did.</li>
<li>Link your existing project</li>
</ul>
<blockquote>
<p>You can install Neon via Vercel. The only real difference here is that you&#39;ll get one bill for Neon through Vercel. Otherwise it&#39;s the same product doing the same thing.</p>
</blockquote>
<p>That&#39;s it! This will handle all secret management and branching for with regards to Vercel.</p>
<h2>Neon Auth</h2>
<p>Neon Auth won&#39;t work until you set the correct callback URL. You&#39;ll take your base Vercel URL which be something like <code>https://test-wiki-smoky.vercel.app/</code> and add that to Neon Auth&#39;s &quot;Trusted Domains&quot; under the configuration tab.</p>
<p>For Neon Auth, it won&#39;t work as-is for the <em>preview environments</em>. This is somewhat intentional - Neon Auth today just has one environment that doesn&#39;t branch, so your preview env would be hitting production, which you may or may not want. I&#39;d say you probably don&#39;t want that.</p>
<p>The way to work around this is to have a second Neon project that is just a Neon Auth project and you&#39;d regularly make a copy of your production Neon Auth to the project Neon Auth so it didn&#39;t fall out of sync (you&#39;d probably anonymize it too) - this isn&#39;t ideal and we&#39;re working on a better situation.</p>
<p>Alternatively you could have your preview environments automatically add their redirect URLs on creation and then have a job to clean them up when they go away. Messy still too.</p>
<p>Or, and hear me out here, you make the devs do it manually for each preview environment that needs it. Annoying, yes, but it also makes the devs handle it and it&#39;s not that burdensome to do - it&#39;s a couple of clicks in the Neon UI. We&#39;re going to skip doing this.</p>
<h2>Upstash</h2>
<p>Feel free to link up Upstash here as well, works the same way. I don&#39;t really <em>use</em> the integration that much - I think it has some novel behavior in Upstash&#39;s dashboard that can monitor different things. Really I just use it to make sure the environment variables stay in sync.</p>
<h2>Resend</h2>
<p>Same as above - this will just create a new API key on the fly and you can track Vercel usage individually. Fine to do or not do, as long as you have a Resend key.</p>
<h2>Blob</h2>
<p>Likewise here, via the Storage tab, you can create a link to your Vercel Storage account so that the UI links up nicely. Or you can just make sure the right variables are populated.</p>
<blockquote>
<p>For some of these, you may need to delete old keys that you put there first to set up the integrations. Vercel Blob is certainly that way (ask me how I know)</p>
</blockquote>
<p>If all of your variables are set, you should be able to see your site working!</p>
</div><div class="lesson-links"><a href="/lessons/ai/cron" class="prev">‚Üê Previous</a><a href="/lessons/devops/speed-insights-analytics-and-observability" class="next">Next ‚Üí</a></div></div><div class="details-bg"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="154" height="154" viewBox="0 0 154 154"><defs><clipPath id="clip-path"><rect id="Rectangle_2238" data-name="Rectangle 2238" width="154" height="154" transform="translate(9467 350)" fill="#fff" stroke="#707070" stroke-width="1"></rect></clipPath><clipPath id="clip-corner-image-active"><rect width="154" height="154"></rect></clipPath></defs><g id="corner-image-active" clip-path="url(#clip-corner-image-active)"><g id="Corner-image-active-2" data-name="Corner-image-active" transform="translate(-9467 -350)" clip-path="url(#clip-path)"><path id="Subtraction_34" data-name="Subtraction 34" d="M-3857.365,1740.766h0l-7.07-7.07,12.89-12.89v14.142l-5.818,5.818Zm-14.142-14.142h0l-7.071-7.07,27.033-27.033v14.143l-19.96,19.96Zm-14.143-14.143h0l-7.07-7.069,41.175-41.175v14.142Zm-14.142-14.142h0l-7.07-7.069,55.317-55.317v14.142Zm-14.142-14.142h0l-7.07-7.069,69.459-69.459v14.142Zm-14.142-14.142h0l-7.07-7.069,76.739-76.739h6.862v7.28Zm-14.143-14.143h0l-7.07-7.069,62.6-62.6h14.142Zm-14.142-14.142h0l-7.07-7.069,48.454-48.454h14.142Zm-14.142-14.142h0l-7.07-7.069,34.312-34.312h14.142Zm-14.142-14.142h0l-7.07-7.069,20.17-20.17h14.142Zm-14.142-14.142h0l-7.071-7.071,6.027-6.027h14.144l-13.1,13.1Zm367.24-56.114v-.909l.455.455-.453.453Z" transform="translate(13472.546 -1236.766)" fill="var(--corner-fill)"></path></g></g></svg></div></div></div></div><noscript><img src="https://a.holt.courses/noscript.gif" alt="" referrerPolicy="no-referrer-when-downgrade"/></noscript><footer class="footer"><ul class="socials"><li class="social"><a href="https://twitter.com/holtbt"><svg fill="none" height="100%" width="32" xmlns="http://www.w3.org/2000/svg" viewBox="0.254 0.25 500 451.95400000000006"><path d="M394.033.25h76.67L303.202 191.693l197.052 260.511h-154.29L225.118 294.205 86.844 452.204H10.127l179.16-204.77L.254.25H158.46l109.234 144.417zm-26.908 406.063h42.483L135.377 43.73h-45.59z" fill="var(--footer-icons)"></path></svg></a></li><li class="social"><a href="https://bsky.app/profile/brianholt.me"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -3.268 64 68.414" width="38" height="100%"><path fill="var(--footer-icons)" d="M13.873 3.805C21.21 9.332 29.103 20.537 32 26.55v15.882c0-.338-.13.044-.41.867-1.512 4.456-7.418 21.847-20.923 7.944-7.111-7.32-3.819-14.64 9.125-16.85-7.405 1.264-15.73-.825-18.014-9.015C1.12 23.022 0 8.51 0 6.55 0-3.268 8.579-.182 13.873 3.805zm36.254 0C42.79 9.332 34.897 20.537 32 26.55v15.882c0-.338.13.044.41.867 1.512 4.456 7.418 21.847 20.923 7.944 7.111-7.32 3.819-14.64-9.125-16.85 7.405 1.264 15.73-.825 18.014-9.015C62.88 23.022 64 8.51 64 6.55c0-9.818-8.578-6.732-13.873-2.745z"></path></svg></a></li><li class="social"><a href="https://github.com/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-github-social"><rect width="32" height="32"></rect></clipPath></defs><g id="github-social" clip-path="url(#clip-github-social)"><g id="Group_272" data-name="Group 272" transform="translate(13522.5 -6994)"><path id="Subtraction_33" data-name="Subtraction 33" d="M-24967.5,8041a15.9,15.9,0,0,1-11.312-4.688A15.893,15.893,0,0,1-24983.5,8025a15.893,15.893,0,0,1,4.689-11.315A15.894,15.894,0,0,1-24967.5,8009a15.894,15.894,0,0,1,11.313,4.686A15.893,15.893,0,0,1-24951.5,8025a15.893,15.893,0,0,1-4.689,11.313A15.9,15.9,0,0,1-24967.5,8041Zm-3.781-4.571h0v3.918h7.895v-6.665a1.836,1.836,0,0,0-1.2-1.718c5.1-.617,7.467-2.975,7.467-7.424a7.176,7.176,0,0,0-1.637-4.728,6.74,6.74,0,0,0,.275-1.812,4.34,4.34,0,0,0-.52-2.452.574.574,0,0,0-.359-.1c-1.061,0-3.465,1.411-3.936,1.694a16.644,16.644,0,0,0-4.2-.489,16.379,16.379,0,0,0-3.969.445c-.846-.5-2.91-1.649-3.859-1.649a.566.566,0,0,0-.354.095,4.3,4.3,0,0,0-.521,2.452,6.7,6.7,0,0,0,.244,1.718,7.346,7.346,0,0,0-1.6,4.822,7.263,7.263,0,0,0,1.533,4.985c1.193,1.359,3.115,2.165,5.871,2.464a1.826,1.826,0,0,0-1.129,1.693v.5h0l-.006,0a7.121,7.121,0,0,1-2.033.363,2.608,2.608,0,0,1-.965-.158,4.438,4.438,0,0,1-1.836-1.881,2.361,2.361,0,0,0-1.248-1.091,3.472,3.472,0,0,0-1.217-.3.584.584,0,0,0-.545.224.282.282,0,0,0,.027.367,1.875,1.875,0,0,0,.447.307,4.732,4.732,0,0,1,.561.355,10.726,10.726,0,0,1,1.682,2.755c.043.092.078.163.105.217a3.876,3.876,0,0,0,2.42,1.185,6.036,6.036,0,0,0,.607.025c.875,0,1.988-.124,2-.125Z" transform="translate(11461 -1015)" fill="var(--footer-icons)"></path><g id="Ellipse_670" data-name="Ellipse 670" transform="translate(-13522.5 6994)" fill="none" stroke="var(--footer-icons)" stroke-width="1"><circle cx="16" cy="16" r="16" stroke="none"></circle><circle cx="16" cy="16" r="15.5" fill="none"></circle></g></g></g></svg></a></li><li class="social"><a href="https://linkedin.com/in/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-linkedin-social"><rect width="32" height="32"></rect></clipPath></defs><g id="linkedin-social" clip-path="url(#clip-linkedin-social)"><g id="Group_270" data-name="Group 270" transform="translate(-86.349 -633.073)"><path id="Path_375" data-name="Path 375" d="M115.789,633.073a2.324,2.324,0,0,1,1.682.676,2.194,2.194,0,0,1,.695,1.627V662.8a2.131,2.131,0,0,1-.695,1.609,2.314,2.314,0,0,1-1.646.659H88.69a2.307,2.307,0,0,1-1.646-.659,2.128,2.128,0,0,1-.695-1.609V635.376a2.19,2.19,0,0,1,.695-1.627,2.322,2.322,0,0,1,1.682-.676h27.063Zm-20.224,9.672a2.561,2.561,0,0,0,0-3.584,2.658,2.658,0,0,0-1.938-.712,2.724,2.724,0,0,0-1.957.712,2.371,2.371,0,0,0-.75,1.792,2.4,2.4,0,0,0,.731,1.792,2.605,2.605,0,0,0,1.9.713h.037A2.7,2.7,0,0,0,95.565,642.745ZM96,645.434H91.213V659.88H96Zm17.3,6.144a7.007,7.007,0,0,0-1.573-4.9,5.68,5.68,0,0,0-6.839-.769,5.663,5.663,0,0,0-1.426,1.573v-2.048H98.674q.036.841,0,7.717v6.728h4.791V651.8a3.592,3.592,0,0,1,.146-1.17,2.913,2.913,0,0,1,.878-1.206,2.429,2.429,0,0,1,1.609-.549,2.108,2.108,0,0,1,1.865.914,4.265,4.265,0,0,1,.549,2.341v7.752H113.3Z" fill="var(--footer-icons)"></path></g></g></svg></a></li><li class="social"><div class="terms"><p>Content Licensed Under CC-BY-NC-4.0</p><p>Code Samples and Exercises Licensed Under Apache 2.0</p><p>Site Designed by<!-- --> <a href="https://www.alexdanielson.com/">Alex Danielson</a></p></div></li></ul><div class="theme-icons"><link id="highlight-theme-light" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.8.0/styles/a11y-light.min.css"/><link id="highlight-theme-dark" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.8.0/styles/a11y-dark.min.css" disabled=""/><button aria-label="Activate dark mode" title="Activate dark mode" class="theme-toggle"><svg xmlns="http://www.w3.org/2000/svg" width="36px" height="100%" viewBox="0 -960 960 960" fill="var(--text-footer)" role="img"><title>Dark Mode Icon</title><path d="M480-120q-150 0-255-105T120-480q0-150 105-255t255-105q14 0 27.5 1t26.5 3q-41 29-65.5 75.5T444-660q0 90 63 153t153 63q55 0 101-24.5t75-65.5q2 13 3 26.5t1 27.5q0 150-105 255T480-120Zm0-80q88 0 158-48.5T740-375q-20 5-40 8t-40 3q-123 0-209.5-86.5T364-660q0-20 3-40t8-40q-78 32-126.5 102T200-480q0 116 82 198t198 82Z"></path></svg></button></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"attributes":{},"html":"\u003cp\u003eWe are going to now do all the fun DevOps parts at the end: we are going to deploy, we are going to do CI/CD, and we are going to do observability and analytics.\u003c/p\u003e\n\u003cp\u003eThere are so many ways to skin this cat so we are going to keep it pretty focused - Vercel offers nearly all of these services built-in and it works really well with Neon and Upstash, so we\u0026#39;re just going to lean on that. If I was just getting started, this is what I\u0026#39;d do - only reason I\u0026#39;d something like a different observability platform or analytics is if I outgrew the perfectly adequate offering on Vercel.\u003c/p\u003e\n\u003cp\u003eGo to GitHub, create a new repo, and push your project into that repo. We\u0026#39;re going to use this to deploy. Once you\u0026#39;ve pushed your code to GitHub, go to Vercel.com and create a new project and connect your GitHub so we can add your repo to this project.\u003c/p\u003e\n\u003cp\u003eI took the liberty here of fixing some stuff up for deployment, namely adding a bunch of tests. This isn\u0026#39;t a testing Next.js course and if you want to see my opinions on testing Next.js \u003ca href=\"https://holt.fyi/intermediate-react\"\u003echeck out my Intermediate React course\u003c/a\u003e - I go into plenty depth there. So instead I just want you to see what to do with the tests once you have them. I\u0026#39;ve added some test specific code that you can look at if you want (for example it doesn\u0026#39;t run the AI summaries in test because it\u0026#39;d waste a lot of tokens)\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eüèÅ This is the \u003ca href=\"https://github.com/btholt/fullstack-next-wiki/tree/main/09-with-tests\"\u003e09-with-tests\u003c/a\u003e checkpoint. Open that folder in the sample project repo to go to where we are as of right here. This is the final version of the project and what we\u0026#39;ll use to deploy.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eAnother note - these days I mostly vibe code my tests - it\u0026#39;s such a perfect use case for it.\u003c/p\u003e\n\u003cp\u003eIn this repo, it\u0026#39;ll now expect \u003cem\u003etwo\u003c/em\u003e sets of variables, if you want to. For the purposes of this course, feel free to just re-use your prod infra for test, but you\u0026#39;ll see how to set up preview environments \u003cem\u003eand\u003c/em\u003e prod environments.\u003c/p\u003e\n\u003cp\u003eNeon will automatically branch your database for you after we set up the integration so don\u0026#39;t worry about those.\u003c/p\u003e\n\u003cp\u003eI personally set up a second Upstash, gave a fake Resend key for email, a second blob storage (which you can connect via the Storage tab but you do still need to add the \u003ccode\u003eBLOB_BASE_URL\u003c/code\u003e manually)\u003c/p\u003e\n\u003cp\u003eFor Neon Auth, it won\u0026#39;t work as-is. This is somewhat intentional - Neon Auth today just has one environment that doesn\u0026#39;t branch, so your preview env would be hitting production, which you may or may not want. I\u0026#39;d say you probably don\u0026#39;t want that.\u003c/p\u003e\n\u003cp\u003eThe way to work around this is to have a second Neon project that is just a Neon Auth project and you\u0026#39;d regularly make a copy of your production Neon Auth to the project Neon Auth so it didn\u0026#39;t fall out of sync (you\u0026#39;d probably anonymize it too) - this isn\u0026#39;t ideal and we\u0026#39;re working on a better situation at Neon.\u003c/p\u003e\n\u003cp\u003eAlternatively you could have your preview environments automatically add their redirect URLs on creation and then have a job to clean them up when they go away. Messy still too.\u003c/p\u003e\n\u003cp\u003eOr, and hear me out here, you make the devs do it manually for each preview environment that needs it. Annoying, yes, but it also makes the devs handle it and it\u0026#39;s not that burdensome to do - it\u0026#39;s a couple of clicks in the Neon UI. We\u0026#39;re going to skip doing this.\u003c/p\u003e\n\u003cp\u003eLastly I just add the AI_GATEWAY_KEY for all envs - it won\u0026#39;t get used in test because I turned it off in test.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eüö® Be sure to not upload every step (like my repo is) - instead just upload the project you\u0026#39;re working on.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eWe don\u0026#39;t need to modify the build or anything because it all should just be default Next.js - Vercel is very much built for Next.js and vice-versa.\u003c/p\u003e\n\u003cp\u003eOnce you\u0026#39;ve done this, your app should be in prod! If you gave Vercel all the permissions it needed, it should also automatically set up all the Vercel preview deployment stuff with no additional work.\u003c/p\u003e\n\u003cp\u003eLet\u0026#39;s hook up everything we need now\u003c/p\u003e\n\u003ch2\u003eNeon\u003c/h2\u003e\n\u003cp\u003eLet\u0026#39;s make Neon work. Vercel and Neon have taken great care to make sure this works really well together so experience is as easy as\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eGo to the project dashboard\u003c/li\u003e\n\u003cli\u003eGo to Settings\u003c/li\u003e\n\u003cli\u003eGo to Integrations\u003c/li\u003e\n\u003cli\u003eBrowse Marketplace\u003c/li\u003e\n\u003cli\u003eSearch for and Click on Neon. \u003ca href=\"https://vercel.com/marketplace/neon\"\u003eYou can also go straight there from here\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eClick Install from the top right, click Link Existing Neon Account since that\u0026#39;s what we did.\u003c/li\u003e\n\u003cli\u003eLink your existing project\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003eYou can install Neon via Vercel. The only real difference here is that you\u0026#39;ll get one bill for Neon through Vercel. Otherwise it\u0026#39;s the same product doing the same thing.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eThat\u0026#39;s it! This will handle all secret management and branching for with regards to Vercel.\u003c/p\u003e\n\u003ch2\u003eNeon Auth\u003c/h2\u003e\n\u003cp\u003eNeon Auth won\u0026#39;t work until you set the correct callback URL. You\u0026#39;ll take your base Vercel URL which be something like \u003ccode\u003ehttps://test-wiki-smoky.vercel.app/\u003c/code\u003e and add that to Neon Auth\u0026#39;s \u0026quot;Trusted Domains\u0026quot; under the configuration tab.\u003c/p\u003e\n\u003cp\u003eFor Neon Auth, it won\u0026#39;t work as-is for the \u003cem\u003epreview environments\u003c/em\u003e. This is somewhat intentional - Neon Auth today just has one environment that doesn\u0026#39;t branch, so your preview env would be hitting production, which you may or may not want. I\u0026#39;d say you probably don\u0026#39;t want that.\u003c/p\u003e\n\u003cp\u003eThe way to work around this is to have a second Neon project that is just a Neon Auth project and you\u0026#39;d regularly make a copy of your production Neon Auth to the project Neon Auth so it didn\u0026#39;t fall out of sync (you\u0026#39;d probably anonymize it too) - this isn\u0026#39;t ideal and we\u0026#39;re working on a better situation.\u003c/p\u003e\n\u003cp\u003eAlternatively you could have your preview environments automatically add their redirect URLs on creation and then have a job to clean them up when they go away. Messy still too.\u003c/p\u003e\n\u003cp\u003eOr, and hear me out here, you make the devs do it manually for each preview environment that needs it. Annoying, yes, but it also makes the devs handle it and it\u0026#39;s not that burdensome to do - it\u0026#39;s a couple of clicks in the Neon UI. We\u0026#39;re going to skip doing this.\u003c/p\u003e\n\u003ch2\u003eUpstash\u003c/h2\u003e\n\u003cp\u003eFeel free to link up Upstash here as well, works the same way. I don\u0026#39;t really \u003cem\u003euse\u003c/em\u003e the integration that much - I think it has some novel behavior in Upstash\u0026#39;s dashboard that can monitor different things. Really I just use it to make sure the environment variables stay in sync.\u003c/p\u003e\n\u003ch2\u003eResend\u003c/h2\u003e\n\u003cp\u003eSame as above - this will just create a new API key on the fly and you can track Vercel usage individually. Fine to do or not do, as long as you have a Resend key.\u003c/p\u003e\n\u003ch2\u003eBlob\u003c/h2\u003e\n\u003cp\u003eLikewise here, via the Storage tab, you can create a link to your Vercel Storage account so that the UI links up nicely. Or you can just make sure the right variables are populated.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eFor some of these, you may need to delete old keys that you put there first to set up the integrations. Vercel Blob is certainly that way (ask me how I know)\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eIf all of your variables are set, you should be able to see your site working!\u003c/p\u003e\n","markdown":"We are going to now do all the fun DevOps parts at the end: we are going to deploy, we are going to do CI/CD, and we are going to do observability and analytics.\n\nThere are so many ways to skin this cat so we are going to keep it pretty focused - Vercel offers nearly all of these services built-in and it works really well with Neon and Upstash, so we're just going to lean on that. If I was just getting started, this is what I'd do - only reason I'd something like a different observability platform or analytics is if I outgrew the perfectly adequate offering on Vercel.\n\nGo to GitHub, create a new repo, and push your project into that repo. We're going to use this to deploy. Once you've pushed your code to GitHub, go to Vercel.com and create a new project and connect your GitHub so we can add your repo to this project.\n\nI took the liberty here of fixing some stuff up for deployment, namely adding a bunch of tests. This isn't a testing Next.js course and if you want to see my opinions on testing Next.js [check out my Intermediate React course][ir6] - I go into plenty depth there. So instead I just want you to see what to do with the tests once you have them. I've added some test specific code that you can look at if you want (for example it doesn't run the AI summaries in test because it'd waste a lot of tokens)\n\n\u003e üèÅ This is the [09-with-tests][checkpoint] checkpoint. Open that folder in the sample project repo to go to where we are as of right here. This is the final version of the project and what we'll use to deploy.\n\nAnother note - these days I mostly vibe code my tests - it's such a perfect use case for it.\n\nIn this repo, it'll now expect _two_ sets of variables, if you want to. For the purposes of this course, feel free to just re-use your prod infra for test, but you'll see how to set up preview environments _and_ prod environments.\n\nNeon will automatically branch your database for you after we set up the integration so don't worry about those.\n\nI personally set up a second Upstash, gave a fake Resend key for email, a second blob storage (which you can connect via the Storage tab but you do still need to add the `BLOB_BASE_URL` manually)\n\nFor Neon Auth, it won't work as-is. This is somewhat intentional - Neon Auth today just has one environment that doesn't branch, so your preview env would be hitting production, which you may or may not want. I'd say you probably don't want that.\n\nThe way to work around this is to have a second Neon project that is just a Neon Auth project and you'd regularly make a copy of your production Neon Auth to the project Neon Auth so it didn't fall out of sync (you'd probably anonymize it too) - this isn't ideal and we're working on a better situation at Neon.\n\nAlternatively you could have your preview environments automatically add their redirect URLs on creation and then have a job to clean them up when they go away. Messy still too.\n\nOr, and hear me out here, you make the devs do it manually for each preview environment that needs it. Annoying, yes, but it also makes the devs handle it and it's not that burdensome to do - it's a couple of clicks in the Neon UI. We're going to skip doing this.\n\nLastly I just add the AI_GATEWAY_KEY for all envs - it won't get used in test because I turned it off in test.\n\n\u003e üö® Be sure to not upload every step (like my repo is) - instead just upload the project you're working on.\n\nWe don't need to modify the build or anything because it all should just be default Next.js - Vercel is very much built for Next.js and vice-versa.\n\nOnce you've done this, your app should be in prod! If you gave Vercel all the permissions it needed, it should also automatically set up all the Vercel preview deployment stuff with no additional work.\n\nLet's hook up everything we need now\n\n## Neon\n\nLet's make Neon work. Vercel and Neon have taken great care to make sure this works really well together so experience is as easy as\n\n- Go to the project dashboard\n- Go to Settings\n- Go to Integrations\n- Browse Marketplace\n- Search for and Click on Neon. [You can also go straight there from here][neon]\n- Click Install from the top right, click Link Existing Neon Account since that's what we did.\n- Link your existing project\n\n\u003e You can install Neon via Vercel. The only real difference here is that you'll get one bill for Neon through Vercel. Otherwise it's the same product doing the same thing.\n\nThat's it! This will handle all secret management and branching for with regards to Vercel.\n\n## Neon Auth\n\nNeon Auth won't work until you set the correct callback URL. You'll take your base Vercel URL which be something like `https://test-wiki-smoky.vercel.app/` and add that to Neon Auth's \"Trusted Domains\" under the configuration tab.\n\nFor Neon Auth, it won't work as-is for the _preview environments_. This is somewhat intentional - Neon Auth today just has one environment that doesn't branch, so your preview env would be hitting production, which you may or may not want. I'd say you probably don't want that.\n\nThe way to work around this is to have a second Neon project that is just a Neon Auth project and you'd regularly make a copy of your production Neon Auth to the project Neon Auth so it didn't fall out of sync (you'd probably anonymize it too) - this isn't ideal and we're working on a better situation.\n\nAlternatively you could have your preview environments automatically add their redirect URLs on creation and then have a job to clean them up when they go away. Messy still too.\n\nOr, and hear me out here, you make the devs do it manually for each preview environment that needs it. Annoying, yes, but it also makes the devs handle it and it's not that burdensome to do - it's a couple of clicks in the Neon UI. We're going to skip doing this.\n\n## Upstash\n\nFeel free to link up Upstash here as well, works the same way. I don't really _use_ the integration that much - I think it has some novel behavior in Upstash's dashboard that can monitor different things. Really I just use it to make sure the environment variables stay in sync.\n\n## Resend\n\nSame as above - this will just create a new API key on the fly and you can track Vercel usage individually. Fine to do or not do, as long as you have a Resend key.\n\n## Blob\n\nLikewise here, via the Storage tab, you can create a link to your Vercel Storage account so that the UI links up nicely. Or you can just make sure the right variables are populated.\n\n\u003e For some of these, you may need to delete old keys that you put there first to set up the integrations. Vercel Blob is certainly that way (ask me how I know)\n\nIf all of your variables are set, you should be able to see your site working!\n\n[ir6]: https://holt.fyi/intermediate-react\n[checkpoint]: https://github.com/btholt/fullstack-next-wiki/tree/main/09-with-tests\n[neon]: https://vercel.com/marketplace/neon\n","slug":"deploy-to-vercel","title":"Deploy to Vercel","section":"DevOps","icon":"cogs","filePath":"/home/runner/work/build-a-fullstack-nextjs-app-v4/build-a-fullstack-nextjs-app-v4/lessons/09-devops/A-deploy-to-vercel.md","nextSlug":"/lessons/devops/speed-insights-analytics-and-observability","prevSlug":"/lessons/ai/cron"}},"__N_SSG":true},"page":"/lessons/[section]/[slug]","query":{"section":"devops","slug":"deploy-to-vercel"},"buildId":"3u4FnQFUETt3ux6gefDHe","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>