<!DOCTYPE html><html><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="width=device-width" data-next-head=""/><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png" data-next-head=""/><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png" data-next-head=""/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png" data-next-head=""/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png" data-next-head=""/><link rel="icon" type="image/x-icon" href="/images/favicon.ico" data-next-head=""/><title data-next-head="">Query with Drizzle – Build a Fullstack Next.js App, v4</title><meta name="description" content="Build a production-ready team wiki from scratch using Next.js, TypeScript, and modern SaaS tools. Master authentication, database integration, AI features, and deployment patterns." data-next-head=""/><meta name="keywords" content="Next.js,fullstack,React,TypeScript,authentication,database,Postgres,Vercel,deployment,SaaS,AI integration,modern web development" data-next-head=""/><meta name="og:description" content="Build a production-ready team wiki from scratch using Next.js, TypeScript, and modern SaaS tools. Master authentication, database integration, AI features, and deployment patterns." data-next-head=""/><meta name="og:title" content="Query with Drizzle – Build a Fullstack Next.js App, v4" data-next-head=""/><meta name="og:image" content="/images/social-share-cover.jpg" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><link data-next-font="size-adjust" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/de2ef606dd4d4a67.css" as="style"/><link rel="stylesheet" href="/_next/static/css/de2ef606dd4d4a67.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-b66ed8ba6f029a99.js" defer=""></script><script src="/_next/static/chunks/framework-b1e5f14688f9ffe6.js" defer=""></script><script src="/_next/static/chunks/main-953f8078176d6f7b.js" defer=""></script><script src="/_next/static/chunks/pages/_app-04cfcdd17f247960.js" defer=""></script><script src="/_next/static/chunks/pages/lessons/%5Bsection%5D/%5Bslug%5D-e3f3acd10ab352ae.js" defer=""></script><script src="/_next/static/XOcKuB9gZ84DgFGtHvLgN/_buildManifest.js" defer=""></script><script src="/_next/static/XOcKuB9gZ84DgFGtHvLgN/_ssgManifest.js" defer=""></script></head><body><script async="" defer="" src="https://a.holt.courses/latest.js"></script><div id="__next"><div class="remix-app"><header class="navbar"><h1 class="navbar-brand"><a href="/">Build a Fullstack Next.js App, v4</a></h1><div class="navbar-info"><a href="https://frontendmasters.com/workshops/fullstack-app-next-v4/" class="cta-btn">Watch on Frontend Masters</a></div></header><div class="content-container"><div class="main"><div class="lesson-container"><div class="lesson"><div class="lesson-content"><p>Let&#39;s start by doing the SELECTS first. Our app is already pulling dummy data via a server helper function, so this makes it pretty simple as we only need to update this server helper as opposed to doing it in the code (and makes it super testable!)</p>
<p>Let&#39;s open src/lib/data/articles.ts.</p>
<pre><code class="hljs language-typescript"><span class="hljs-comment">// replace everything but the getArticlesById function - we&#x27;ll do that in a sec</span>
<span class="hljs-keyword">import</span> db <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/db/index&quot;</span>;
<span class="hljs-keyword">import</span> { articles } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/db/schema&quot;</span>;
<span class="hljs-keyword">import</span> { eq } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;drizzle-orm&quot;</span>;
<span class="hljs-keyword">import</span> { usersSync } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;drizzle-orm/neon&quot;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getArticles</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> db
    .<span class="hljs-title function_">select</span>({
      <span class="hljs-attr">title</span>: articles.<span class="hljs-property">title</span>,
      <span class="hljs-attr">id</span>: articles.<span class="hljs-property">id</span>,
      <span class="hljs-attr">createdAt</span>: articles.<span class="hljs-property">createdAt</span>,
      <span class="hljs-attr">content</span>: articles.<span class="hljs-property">content</span>,
      <span class="hljs-attr">author</span>: usersSync.<span class="hljs-property">name</span>,
    })
    .<span class="hljs-title function_">from</span>(articles)
    .<span class="hljs-title function_">leftJoin</span>(usersSync, <span class="hljs-title function_">eq</span>(articles.<span class="hljs-property">authorId</span>, usersSync.<span class="hljs-property">id</span>));
  <span class="hljs-keyword">return</span> response;
}
</code></pre><ul>
<li>We&#39;re first importing our db client. This is what will actually connect to the database.</li>
<li>We then import the articles schema. Why? This is how you reference which table you want to query. We want the articles table, so we import that schema.</li>
<li>In the function, we run a select, choose what columns we want, tell it which table it&#39;s coming from, and then join in the author&#39;s name (because we want to say the article was written by Bob, not &quot;user-12334&quot;)</li>
<li>We added the where clause and used <code>eq</code> which, as you may imagine, checks for equality. Here we&#39;re saying we want to do the join on where the authorId in the article table is the same as the usersSync id so we can get a name instead of an ID.</li>
<li>And then we return the array of rows! That&#39;s it!</li>
<li>This does not paginate. But it&#39;s very easy to do with either <a href="https://orm.drizzle.team/docs/guides/cursor-based-pagination">cursors</a> or just using limit() and offset like normal SQL. Feel free to implement this yourself!</li>
</ul>
<p>This should make articles on the home page pull from the database! Hooray! Let&#39;s make the articles page pull from it too.</p>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getArticleById</span>(<span class="hljs-params"><span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span></span>) {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> db
    .<span class="hljs-title function_">select</span>({
      <span class="hljs-attr">title</span>: articles.<span class="hljs-property">title</span>,
      <span class="hljs-attr">id</span>: articles.<span class="hljs-property">id</span>,
      <span class="hljs-attr">createdAt</span>: articles.<span class="hljs-property">createdAt</span>,
      <span class="hljs-attr">content</span>: articles.<span class="hljs-property">content</span>,
      <span class="hljs-attr">author</span>: usersSync.<span class="hljs-property">name</span>,
      <span class="hljs-attr">imageUrl</span>: articles.<span class="hljs-property">imageUrl</span>,
    })
    .<span class="hljs-title function_">from</span>(articles)
    .<span class="hljs-title function_">where</span>(<span class="hljs-title function_">eq</span>(articles.<span class="hljs-property">id</span>, id))
    .<span class="hljs-title function_">leftJoin</span>(usersSync, <span class="hljs-title function_">eq</span>(articles.<span class="hljs-property">authorId</span>, usersSync.<span class="hljs-property">id</span>));
  <span class="hljs-keyword">return</span> response[<span class="hljs-number">0</span>] ? response[<span class="hljs-number">0</span>] : <span class="hljs-literal">null</span>;
}
</code></pre><ul>
<li>Here we just added the where filter to filter it down to one record, the correct article ID.</li>
<li>Drizzle doesn&#39;t have a select one function, but it&#39;s indexed so it&#39;s not a big deal.</li>
<li>You&#39;ll notice that the two functions are quite similar, and there might be some DRY part of your brain twitching here, but I&#39;d say calm it and tell it that it&#39;s fine that we repeated ourselves. These two functions accomplish different things, and it&#39;s possible we could want to optimize them individually the future. There&#39;s no need for complex abstractions here, just have some WET (write everything twice/thrice) code here, no big deal.</li>
<li>By the end of this project this will be the only data helper, but I like this pattern of having helpers to call database functions instead of just having the raw DB queries in your React UI - makes it a bit more centrally maintained that the UI access patterns and the underlying DB are maintained separately and can be modified either way without disturbing the other too much.</li>
</ul>
<p>Awesome! That&#39;s our SELECTs! Let&#39;s go do our writes!</p>
</div><div class="lesson-links"><a href="/lessons/database/setting-up-drizzle" class="prev">← Previous</a><a href="/lessons/database/writes-with-drizzle" class="next">Next →</a></div></div><div class="details-bg"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="154" height="154" viewBox="0 0 154 154"><defs><clipPath id="clip-path"><rect id="Rectangle_2238" data-name="Rectangle 2238" width="154" height="154" transform="translate(9467 350)" fill="#fff" stroke="#707070" stroke-width="1"></rect></clipPath><clipPath id="clip-corner-image-active"><rect width="154" height="154"></rect></clipPath></defs><g id="corner-image-active" clip-path="url(#clip-corner-image-active)"><g id="Corner-image-active-2" data-name="Corner-image-active" transform="translate(-9467 -350)" clip-path="url(#clip-path)"><path id="Subtraction_34" data-name="Subtraction 34" d="M-3857.365,1740.766h0l-7.07-7.07,12.89-12.89v14.142l-5.818,5.818Zm-14.142-14.142h0l-7.071-7.07,27.033-27.033v14.143l-19.96,19.96Zm-14.143-14.143h0l-7.07-7.069,41.175-41.175v14.142Zm-14.142-14.142h0l-7.07-7.069,55.317-55.317v14.142Zm-14.142-14.142h0l-7.07-7.069,69.459-69.459v14.142Zm-14.142-14.142h0l-7.07-7.069,76.739-76.739h6.862v7.28Zm-14.143-14.143h0l-7.07-7.069,62.6-62.6h14.142Zm-14.142-14.142h0l-7.07-7.069,48.454-48.454h14.142Zm-14.142-14.142h0l-7.07-7.069,34.312-34.312h14.142Zm-14.142-14.142h0l-7.07-7.069,20.17-20.17h14.142Zm-14.142-14.142h0l-7.071-7.071,6.027-6.027h14.144l-13.1,13.1Zm367.24-56.114v-.909l.455.455-.453.453Z" transform="translate(13472.546 -1236.766)" fill="var(--corner-fill)"></path></g></g></svg></div></div></div></div><noscript><img src="https://a.holt.courses/noscript.gif" alt="" referrerPolicy="no-referrer-when-downgrade"/></noscript><footer class="footer"><ul class="socials"><li class="social"><a href="https://twitter.com/holtbt"><svg fill="none" height="100%" width="32" xmlns="http://www.w3.org/2000/svg" viewBox="0.254 0.25 500 451.95400000000006"><path d="M394.033.25h76.67L303.202 191.693l197.052 260.511h-154.29L225.118 294.205 86.844 452.204H10.127l179.16-204.77L.254.25H158.46l109.234 144.417zm-26.908 406.063h42.483L135.377 43.73h-45.59z" fill="var(--footer-icons)"></path></svg></a></li><li class="social"><a href="https://bsky.app/profile/brianholt.me"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -3.268 64 68.414" width="38" height="100%"><path fill="var(--footer-icons)" d="M13.873 3.805C21.21 9.332 29.103 20.537 32 26.55v15.882c0-.338-.13.044-.41.867-1.512 4.456-7.418 21.847-20.923 7.944-7.111-7.32-3.819-14.64 9.125-16.85-7.405 1.264-15.73-.825-18.014-9.015C1.12 23.022 0 8.51 0 6.55 0-3.268 8.579-.182 13.873 3.805zm36.254 0C42.79 9.332 34.897 20.537 32 26.55v15.882c0-.338.13.044.41.867 1.512 4.456 7.418 21.847 20.923 7.944 7.111-7.32 3.819-14.64-9.125-16.85 7.405 1.264 15.73-.825 18.014-9.015C62.88 23.022 64 8.51 64 6.55c0-9.818-8.578-6.732-13.873-2.745z"></path></svg></a></li><li class="social"><a href="https://github.com/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-github-social"><rect width="32" height="32"></rect></clipPath></defs><g id="github-social" clip-path="url(#clip-github-social)"><g id="Group_272" data-name="Group 272" transform="translate(13522.5 -6994)"><path id="Subtraction_33" data-name="Subtraction 33" d="M-24967.5,8041a15.9,15.9,0,0,1-11.312-4.688A15.893,15.893,0,0,1-24983.5,8025a15.893,15.893,0,0,1,4.689-11.315A15.894,15.894,0,0,1-24967.5,8009a15.894,15.894,0,0,1,11.313,4.686A15.893,15.893,0,0,1-24951.5,8025a15.893,15.893,0,0,1-4.689,11.313A15.9,15.9,0,0,1-24967.5,8041Zm-3.781-4.571h0v3.918h7.895v-6.665a1.836,1.836,0,0,0-1.2-1.718c5.1-.617,7.467-2.975,7.467-7.424a7.176,7.176,0,0,0-1.637-4.728,6.74,6.74,0,0,0,.275-1.812,4.34,4.34,0,0,0-.52-2.452.574.574,0,0,0-.359-.1c-1.061,0-3.465,1.411-3.936,1.694a16.644,16.644,0,0,0-4.2-.489,16.379,16.379,0,0,0-3.969.445c-.846-.5-2.91-1.649-3.859-1.649a.566.566,0,0,0-.354.095,4.3,4.3,0,0,0-.521,2.452,6.7,6.7,0,0,0,.244,1.718,7.346,7.346,0,0,0-1.6,4.822,7.263,7.263,0,0,0,1.533,4.985c1.193,1.359,3.115,2.165,5.871,2.464a1.826,1.826,0,0,0-1.129,1.693v.5h0l-.006,0a7.121,7.121,0,0,1-2.033.363,2.608,2.608,0,0,1-.965-.158,4.438,4.438,0,0,1-1.836-1.881,2.361,2.361,0,0,0-1.248-1.091,3.472,3.472,0,0,0-1.217-.3.584.584,0,0,0-.545.224.282.282,0,0,0,.027.367,1.875,1.875,0,0,0,.447.307,4.732,4.732,0,0,1,.561.355,10.726,10.726,0,0,1,1.682,2.755c.043.092.078.163.105.217a3.876,3.876,0,0,0,2.42,1.185,6.036,6.036,0,0,0,.607.025c.875,0,1.988-.124,2-.125Z" transform="translate(11461 -1015)" fill="var(--footer-icons)"></path><g id="Ellipse_670" data-name="Ellipse 670" transform="translate(-13522.5 6994)" fill="none" stroke="var(--footer-icons)" stroke-width="1"><circle cx="16" cy="16" r="16" stroke="none"></circle><circle cx="16" cy="16" r="15.5" fill="none"></circle></g></g></g></svg></a></li><li class="social"><a href="https://linkedin.com/in/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-linkedin-social"><rect width="32" height="32"></rect></clipPath></defs><g id="linkedin-social" clip-path="url(#clip-linkedin-social)"><g id="Group_270" data-name="Group 270" transform="translate(-86.349 -633.073)"><path id="Path_375" data-name="Path 375" d="M115.789,633.073a2.324,2.324,0,0,1,1.682.676,2.194,2.194,0,0,1,.695,1.627V662.8a2.131,2.131,0,0,1-.695,1.609,2.314,2.314,0,0,1-1.646.659H88.69a2.307,2.307,0,0,1-1.646-.659,2.128,2.128,0,0,1-.695-1.609V635.376a2.19,2.19,0,0,1,.695-1.627,2.322,2.322,0,0,1,1.682-.676h27.063Zm-20.224,9.672a2.561,2.561,0,0,0,0-3.584,2.658,2.658,0,0,0-1.938-.712,2.724,2.724,0,0,0-1.957.712,2.371,2.371,0,0,0-.75,1.792,2.4,2.4,0,0,0,.731,1.792,2.605,2.605,0,0,0,1.9.713h.037A2.7,2.7,0,0,0,95.565,642.745ZM96,645.434H91.213V659.88H96Zm17.3,6.144a7.007,7.007,0,0,0-1.573-4.9,5.68,5.68,0,0,0-6.839-.769,5.663,5.663,0,0,0-1.426,1.573v-2.048H98.674q.036.841,0,7.717v6.728h4.791V651.8a3.592,3.592,0,0,1,.146-1.17,2.913,2.913,0,0,1,.878-1.206,2.429,2.429,0,0,1,1.609-.549,2.108,2.108,0,0,1,1.865.914,4.265,4.265,0,0,1,.549,2.341v7.752H113.3Z" fill="var(--footer-icons)"></path></g></g></svg></a></li><li class="social"><div class="terms"><p>Content Licensed Under CC-BY-NC-4.0</p><p>Code Samples and Exercises Licensed Under Apache 2.0</p><p>Site Designed by<!-- --> <a href="https://www.alexdanielson.com/">Alex Danielson</a></p></div></li></ul><div class="theme-icons"><link id="highlight-theme-light" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.8.0/styles/a11y-light.min.css"/><link id="highlight-theme-dark" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.8.0/styles/a11y-dark.min.css" disabled=""/><button aria-label="Activate dark mode" title="Activate dark mode" class="theme-toggle"><svg xmlns="http://www.w3.org/2000/svg" width="36px" height="100%" viewBox="0 -960 960 960" fill="var(--text-footer)" role="img"><title>Dark Mode Icon</title><path d="M480-120q-150 0-255-105T120-480q0-150 105-255t255-105q14 0 27.5 1t26.5 3q-41 29-65.5 75.5T444-660q0 90 63 153t153 63q55 0 101-24.5t75-65.5q2 13 3 26.5t1 27.5q0 150-105 255T480-120Zm0-80q88 0 158-48.5T740-375q-20 5-40 8t-40 3q-123 0-209.5-86.5T364-660q0-20 3-40t8-40q-78 32-126.5 102T200-480q0 116 82 198t198 82Z"></path></svg></button></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"attributes":{},"html":"\u003cp\u003eLet\u0026#39;s start by doing the SELECTS first. Our app is already pulling dummy data via a server helper function, so this makes it pretty simple as we only need to update this server helper as opposed to doing it in the code (and makes it super testable!)\u003c/p\u003e\n\u003cp\u003eLet\u0026#39;s open src/lib/data/articles.ts.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// replace everything but the getArticlesById function - we\u0026#x27;ll do that in a sec\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e db \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@/db/index\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { articles } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@/db/schema\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { eq } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;drizzle-orm\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { usersSync } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;drizzle-orm/neon\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003egetArticles\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e response = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e db\n    .\u003cspan class=\"hljs-title function_\"\u003eselect\u003c/span\u003e({\n      \u003cspan class=\"hljs-attr\"\u003etitle\u003c/span\u003e: articles.\u003cspan class=\"hljs-property\"\u003etitle\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e: articles.\u003cspan class=\"hljs-property\"\u003eid\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003ecreatedAt\u003c/span\u003e: articles.\u003cspan class=\"hljs-property\"\u003ecreatedAt\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003econtent\u003c/span\u003e: articles.\u003cspan class=\"hljs-property\"\u003econtent\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003eauthor\u003c/span\u003e: usersSync.\u003cspan class=\"hljs-property\"\u003ename\u003c/span\u003e,\n    })\n    .\u003cspan class=\"hljs-title function_\"\u003efrom\u003c/span\u003e(articles)\n    .\u003cspan class=\"hljs-title function_\"\u003eleftJoin\u003c/span\u003e(usersSync, \u003cspan class=\"hljs-title function_\"\u003eeq\u003c/span\u003e(articles.\u003cspan class=\"hljs-property\"\u003eauthorId\u003c/span\u003e, usersSync.\u003cspan class=\"hljs-property\"\u003eid\u003c/span\u003e));\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e response;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003eWe\u0026#39;re first importing our db client. This is what will actually connect to the database.\u003c/li\u003e\n\u003cli\u003eWe then import the articles schema. Why? This is how you reference which table you want to query. We want the articles table, so we import that schema.\u003c/li\u003e\n\u003cli\u003eIn the function, we run a select, choose what columns we want, tell it which table it\u0026#39;s coming from, and then join in the author\u0026#39;s name (because we want to say the article was written by Bob, not \u0026quot;user-12334\u0026quot;)\u003c/li\u003e\n\u003cli\u003eWe added the where clause and used \u003ccode\u003eeq\u003c/code\u003e which, as you may imagine, checks for equality. Here we\u0026#39;re saying we want to do the join on where the authorId in the article table is the same as the usersSync id so we can get a name instead of an ID.\u003c/li\u003e\n\u003cli\u003eAnd then we return the array of rows! That\u0026#39;s it!\u003c/li\u003e\n\u003cli\u003eThis does not paginate. But it\u0026#39;s very easy to do with either \u003ca href=\"https://orm.drizzle.team/docs/guides/cursor-based-pagination\"\u003ecursors\u003c/a\u003e or just using limit() and offset like normal SQL. Feel free to implement this yourself!\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThis should make articles on the home page pull from the database! Hooray! Let\u0026#39;s make the articles page pull from it too.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003egetArticleById\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003enumber\u003c/span\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e response = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e db\n    .\u003cspan class=\"hljs-title function_\"\u003eselect\u003c/span\u003e({\n      \u003cspan class=\"hljs-attr\"\u003etitle\u003c/span\u003e: articles.\u003cspan class=\"hljs-property\"\u003etitle\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e: articles.\u003cspan class=\"hljs-property\"\u003eid\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003ecreatedAt\u003c/span\u003e: articles.\u003cspan class=\"hljs-property\"\u003ecreatedAt\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003econtent\u003c/span\u003e: articles.\u003cspan class=\"hljs-property\"\u003econtent\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003eauthor\u003c/span\u003e: usersSync.\u003cspan class=\"hljs-property\"\u003ename\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003eimageUrl\u003c/span\u003e: articles.\u003cspan class=\"hljs-property\"\u003eimageUrl\u003c/span\u003e,\n    })\n    .\u003cspan class=\"hljs-title function_\"\u003efrom\u003c/span\u003e(articles)\n    .\u003cspan class=\"hljs-title function_\"\u003ewhere\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003eeq\u003c/span\u003e(articles.\u003cspan class=\"hljs-property\"\u003eid\u003c/span\u003e, id))\n    .\u003cspan class=\"hljs-title function_\"\u003eleftJoin\u003c/span\u003e(usersSync, \u003cspan class=\"hljs-title function_\"\u003eeq\u003c/span\u003e(articles.\u003cspan class=\"hljs-property\"\u003eauthorId\u003c/span\u003e, usersSync.\u003cspan class=\"hljs-property\"\u003eid\u003c/span\u003e));\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e response[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e] ? response[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e] : \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003eHere we just added the where filter to filter it down to one record, the correct article ID.\u003c/li\u003e\n\u003cli\u003eDrizzle doesn\u0026#39;t have a select one function, but it\u0026#39;s indexed so it\u0026#39;s not a big deal.\u003c/li\u003e\n\u003cli\u003eYou\u0026#39;ll notice that the two functions are quite similar, and there might be some DRY part of your brain twitching here, but I\u0026#39;d say calm it and tell it that it\u0026#39;s fine that we repeated ourselves. These two functions accomplish different things, and it\u0026#39;s possible we could want to optimize them individually the future. There\u0026#39;s no need for complex abstractions here, just have some WET (write everything twice/thrice) code here, no big deal.\u003c/li\u003e\n\u003cli\u003eBy the end of this project this will be the only data helper, but I like this pattern of having helpers to call database functions instead of just having the raw DB queries in your React UI - makes it a bit more centrally maintained that the UI access patterns and the underlying DB are maintained separately and can be modified either way without disturbing the other too much.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eAwesome! That\u0026#39;s our SELECTs! Let\u0026#39;s go do our writes!\u003c/p\u003e\n","markdown":"Let's start by doing the SELECTS first. Our app is already pulling dummy data via a server helper function, so this makes it pretty simple as we only need to update this server helper as opposed to doing it in the code (and makes it super testable!)\n\nLet's open src/lib/data/articles.ts.\n\n```typescript\n// replace everything but the getArticlesById function - we'll do that in a sec\nimport db from \"@/db/index\";\nimport { articles } from \"@/db/schema\";\nimport { eq } from \"drizzle-orm\";\nimport { usersSync } from \"drizzle-orm/neon\";\n\nexport async function getArticles() {\n  const response = await db\n    .select({\n      title: articles.title,\n      id: articles.id,\n      createdAt: articles.createdAt,\n      content: articles.content,\n      author: usersSync.name,\n    })\n    .from(articles)\n    .leftJoin(usersSync, eq(articles.authorId, usersSync.id));\n  return response;\n}\n```\n\n- We're first importing our db client. This is what will actually connect to the database.\n- We then import the articles schema. Why? This is how you reference which table you want to query. We want the articles table, so we import that schema.\n- In the function, we run a select, choose what columns we want, tell it which table it's coming from, and then join in the author's name (because we want to say the article was written by Bob, not \"user-12334\")\n- We added the where clause and used `eq` which, as you may imagine, checks for equality. Here we're saying we want to do the join on where the authorId in the article table is the same as the usersSync id so we can get a name instead of an ID.\n- And then we return the array of rows! That's it!\n- This does not paginate. But it's very easy to do with either [cursors][cursors] or just using limit() and offset like normal SQL. Feel free to implement this yourself!\n\n[cursors]: https://orm.drizzle.team/docs/guides/cursor-based-pagination\n\nThis should make articles on the home page pull from the database! Hooray! Let's make the articles page pull from it too.\n\n```typescript\nexport async function getArticleById(id: number) {\n  const response = await db\n    .select({\n      title: articles.title,\n      id: articles.id,\n      createdAt: articles.createdAt,\n      content: articles.content,\n      author: usersSync.name,\n      imageUrl: articles.imageUrl,\n    })\n    .from(articles)\n    .where(eq(articles.id, id))\n    .leftJoin(usersSync, eq(articles.authorId, usersSync.id));\n  return response[0] ? response[0] : null;\n}\n```\n\n- Here we just added the where filter to filter it down to one record, the correct article ID.\n- Drizzle doesn't have a select one function, but it's indexed so it's not a big deal.\n- You'll notice that the two functions are quite similar, and there might be some DRY part of your brain twitching here, but I'd say calm it and tell it that it's fine that we repeated ourselves. These two functions accomplish different things, and it's possible we could want to optimize them individually the future. There's no need for complex abstractions here, just have some WET (write everything twice/thrice) code here, no big deal.\n- By the end of this project this will be the only data helper, but I like this pattern of having helpers to call database functions instead of just having the raw DB queries in your React UI - makes it a bit more centrally maintained that the UI access patterns and the underlying DB are maintained separately and can be modified either way without disturbing the other too much.\n\nAwesome! That's our SELECTs! Let's go do our writes!\n","slug":"query-with-drizzle","title":"Query with Drizzle","section":"Database","icon":"database","filePath":"/home/runner/work/build-a-fullstack-nextjs-app-v4/build-a-fullstack-nextjs-app-v4/lessons/04-database/C-query-with-drizzle.md","nextSlug":"/lessons/database/writes-with-drizzle","prevSlug":"/lessons/database/setting-up-drizzle"}},"__N_SSG":true},"page":"/lessons/[section]/[slug]","query":{"section":"database","slug":"query-with-drizzle"},"buildId":"XOcKuB9gZ84DgFGtHvLgN","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>