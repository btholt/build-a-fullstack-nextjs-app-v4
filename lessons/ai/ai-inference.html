<!DOCTYPE html><html><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="width=device-width" data-next-head=""/><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png" data-next-head=""/><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png" data-next-head=""/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png" data-next-head=""/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png" data-next-head=""/><link rel="icon" type="image/x-icon" href="/images/favicon.ico" data-next-head=""/><title data-next-head="">AI Inference – Build a Fullstack Next.js App, v4</title><meta name="description" content="Build a production-ready team wiki from scratch using Next.js, TypeScript, and modern SaaS tools. Master authentication, database integration, AI features, and deployment patterns." data-next-head=""/><meta name="keywords" content="Next.js,fullstack,React,TypeScript,authentication,database,Postgres,Vercel,deployment,SaaS,AI integration,modern web development" data-next-head=""/><meta name="og:description" content="Build a production-ready team wiki from scratch using Next.js, TypeScript, and modern SaaS tools. Master authentication, database integration, AI features, and deployment patterns." data-next-head=""/><meta name="og:title" content="AI Inference – Build a Fullstack Next.js App, v4" data-next-head=""/><meta name="og:image" content="/images/social-share-cover.jpg" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><link data-next-font="size-adjust" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/de2ef606dd4d4a67.css" as="style"/><link rel="stylesheet" href="/_next/static/css/de2ef606dd4d4a67.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-b66ed8ba6f029a99.js" defer=""></script><script src="/_next/static/chunks/framework-b1e5f14688f9ffe6.js" defer=""></script><script src="/_next/static/chunks/main-953f8078176d6f7b.js" defer=""></script><script src="/_next/static/chunks/pages/_app-04cfcdd17f247960.js" defer=""></script><script src="/_next/static/chunks/pages/lessons/%5Bsection%5D/%5Bslug%5D-e3f3acd10ab352ae.js" defer=""></script><script src="/_next/static/XOcKuB9gZ84DgFGtHvLgN/_buildManifest.js" defer=""></script><script src="/_next/static/XOcKuB9gZ84DgFGtHvLgN/_ssgManifest.js" defer=""></script></head><body><script async="" defer="" src="https://a.holt.courses/latest.js"></script><div id="__next"><div class="remix-app"><header class="navbar"><h1 class="navbar-brand"><a href="/">Build a Fullstack Next.js App, v4</a></h1><div class="navbar-info"><a href="https://frontendmasters.com/workshops/fullstack-app-next-v4/" class="cta-btn">Watch on Frontend Masters</a></div></header><div class="content-container"><div class="main"><div class="lesson-container"><div class="lesson"><div class="lesson-content"><p>Let&#39;s build!</p>
<p>In your src directory, create an ai directory. In there put a summarize.ts file and put this in there</p>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">import</span> { generateText } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;ai&quot;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">summarizeArticle</span>(<span class="hljs-params">
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>,
  <span class="hljs-attr">article</span>: <span class="hljs-built_in">string</span>
</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {
  <span class="hljs-keyword">if</span> (!article || !article.<span class="hljs-title function_">trim</span>()) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Article content is required to generate a summary.&quot;</span>);
  }

  <span class="hljs-keyword">const</span> prompt = <span class="hljs-string">`Summarize the following wiki article in 1-2 concise sentences. Focus on the main idea and the most important details a reader should remember. Do not add opinions or unrelated information. The point is that readers can see the summary a glance and decide if they want to read more.\n\nTitle:\n<span class="hljs-subst">${title}</span>\n\nArticle:\n<span class="hljs-subst">${article}</span>`</span>;

  <span class="hljs-keyword">const</span> { text } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">generateText</span>({
    <span class="hljs-attr">model</span>: <span class="hljs-string">&quot;openai/gpt-5-nano&quot;</span>,
    <span class="hljs-attr">system</span>: <span class="hljs-string">&quot;You are an assistant that writes concise factual summaries.&quot;</span>,
    prompt,
  });

  <span class="hljs-keyword">return</span> (text ?? <span class="hljs-string">&quot;&quot;</span>).<span class="hljs-title function_">trim</span>();
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> summarizeArticle;
</code></pre><p>I love the AI SDK. It&#39;s a much nicer experience than say the OpenAI SDK&#39;s rituals can be, in my opinion.</p>
<p>What&#39;s cool about the AI SDK is you can easily switch it to use Anthropic, OpenAI, etc. directly instead of going through Vercel. Smart marketing on their part because it means you can use their SDK no matter what and it&#39;s easy to switch to their AI Gateway</p>
<p>Let&#39;s say you wanted to use Anthropic directly. Here&#39;s what you&#39;d do.</p>
<blockquote>
<p>I&#39;m going to use the Vercel AI Gateway so only do these next steps if you want to switch. I just wanted to show you how easy it is to switch.</p>
</blockquote>
<pre><code class="hljs language-bash">npm i @ai-sdk/anthropic
</code></pre><pre><code class="hljs language-typescript"><span class="hljs-comment">// at top</span>
<span class="hljs-keyword">import</span> { anthropic } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@ai-sdk/anthropic&quot;</span>;

<span class="hljs-comment">// replace model</span>
<span class="hljs-attr">model</span>: <span class="hljs-title function_">anthropic</span>(<span class="hljs-string">&quot;claude-haiku-4-5&quot;</span>),
</code></pre><p>That&#39;s it! Now instead of going to Vercel&#39;s AI Gateway, you&#39;re going directly Anthropic. This would be helpful if you already had money on your Anthropic account and didn&#39;t want to fill up a Vercel account. We&#39;re not doing this, and we&#39;re just going to use Vercel&#39;s AI Gateway.</p>
<blockquote>
<p>I chose <code>openai/gpt-5-nano</code> because it was cheapest of the frontier models as of writing. Summarizing is the most basic AI task and basically any model can do it pretty well. Feel free to experiment here. <a href="https://vercel.com/ai-gateway/models">Here are the models supported</a>. Also, just throwing out that the prompt could be improved. This will do the job but feel free to iterate.</p>
</blockquote>
<p>Okay, let&#39;s add it to our server actions. Update actions/articles.ts</p>
<pre><code class="hljs language-typescript"><span class="hljs-comment">// at top</span>
<span class="hljs-keyword">import</span> summarizeArticle <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@/ai/summarize&quot;</span>;

<span class="hljs-comment">// replace db call in create</span>
<span class="hljs-keyword">const</span> summary = <span class="hljs-keyword">await</span> <span class="hljs-title function_">summarizeArticle</span>(data.<span class="hljs-property">title</span> || <span class="hljs-string">&quot;&quot;</span>, data.<span class="hljs-property">content</span> || <span class="hljs-string">&quot;&quot;</span>);
<span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> db.<span class="hljs-title function_">insert</span>(articles).<span class="hljs-title function_">values</span>({
  <span class="hljs-attr">title</span>: data.<span class="hljs-property">title</span>,
  <span class="hljs-attr">content</span>: data.<span class="hljs-property">content</span>,
  <span class="hljs-attr">slug</span>: <span class="hljs-string">&quot;&quot;</span> + <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
  <span class="hljs-attr">published</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">authorId</span>: user.<span class="hljs-property">id</span>,
  <span class="hljs-attr">imageUrl</span>: data.<span class="hljs-property">imageUrl</span> ?? <span class="hljs-literal">undefined</span>,
  summary, <span class="hljs-comment">// add</span>
});

<span class="hljs-comment">// replace db call in update</span>
<span class="hljs-keyword">const</span> summary = <span class="hljs-keyword">await</span> <span class="hljs-title function_">summarizeArticle</span>(data.<span class="hljs-property">title</span> || <span class="hljs-string">&quot;&quot;</span>, data.<span class="hljs-property">content</span> || <span class="hljs-string">&quot;&quot;</span>);
<span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> db
  .<span class="hljs-title function_">update</span>(articles)
  .<span class="hljs-title function_">set</span>({
    <span class="hljs-attr">title</span>: data.<span class="hljs-property">title</span>,
    <span class="hljs-attr">content</span>: data.<span class="hljs-property">content</span>,
    <span class="hljs-attr">imageUrl</span>: data.<span class="hljs-property">imageUrl</span> ?? <span class="hljs-literal">undefined</span>,
    <span class="hljs-attr">summary</span>: summary ?? <span class="hljs-literal">undefined</span>, <span class="hljs-comment">// add</span>
  })
  .<span class="hljs-title function_">where</span>(<span class="hljs-title function_">eq</span>(articles.<span class="hljs-property">id</span>, +id));
</code></pre><ul>
<li>We&#39;re just using our new module and inserting into the database.</li>
<li>The summary <em>and</em> the title should always be there from the frontend. If it wasn&#39;t then we&#39;d need to select the necessary fields from the database and then do the summary. You could be more defensive here, but I&#39;m keeping it simple.</li>
</ul>
<p>Let&#39;s go add it to the database. Go to db/schema.ts</p>
<pre><code class="hljs language-typescript"><span class="hljs-comment">// add the row</span>
<span class="hljs-attr">summary</span>: <span class="hljs-title function_">text</span>(<span class="hljs-string">&quot;summary&quot;</span>),
</code></pre><p>Now run these CLI commands</p>
<pre><code class="hljs language-typescript">npm run <span class="hljs-attr">db</span>:generate
npm run <span class="hljs-attr">db</span>:migrate
</code></pre><blockquote>
<p>You may have a problem with untracked migrations, particularly if you played around with <code>drizzle-kit push</code>. There&#39;s a bunch of ways to handle this, but I found the easiest way to just drop the articles table and <code>npm run db:migrate</code> again and then run <code>npm run db:seed</code> again.</p>
</blockquote>
<p>Awesome, now, finally, let&#39;s add it to the select in data/articles.ts</p>
<pre><code class="hljs language-typescript"><span class="hljs-comment">// replace `getArticles` field</span>
<span class="hljs-attr">summary</span>: articles.<span class="hljs-property">summary</span>,
</code></pre><p>Now we can see the summary on the home page for new and edited articles!</p>
</div><div class="lesson-links"><a href="/lessons/ai/vercel-ai-gateway" class="prev">← Previous</a><a href="/lessons/ai/cron" class="next">Next →</a></div></div><div class="details-bg"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="154" height="154" viewBox="0 0 154 154"><defs><clipPath id="clip-path"><rect id="Rectangle_2238" data-name="Rectangle 2238" width="154" height="154" transform="translate(9467 350)" fill="#fff" stroke="#707070" stroke-width="1"></rect></clipPath><clipPath id="clip-corner-image-active"><rect width="154" height="154"></rect></clipPath></defs><g id="corner-image-active" clip-path="url(#clip-corner-image-active)"><g id="Corner-image-active-2" data-name="Corner-image-active" transform="translate(-9467 -350)" clip-path="url(#clip-path)"><path id="Subtraction_34" data-name="Subtraction 34" d="M-3857.365,1740.766h0l-7.07-7.07,12.89-12.89v14.142l-5.818,5.818Zm-14.142-14.142h0l-7.071-7.07,27.033-27.033v14.143l-19.96,19.96Zm-14.143-14.143h0l-7.07-7.069,41.175-41.175v14.142Zm-14.142-14.142h0l-7.07-7.069,55.317-55.317v14.142Zm-14.142-14.142h0l-7.07-7.069,69.459-69.459v14.142Zm-14.142-14.142h0l-7.07-7.069,76.739-76.739h6.862v7.28Zm-14.143-14.143h0l-7.07-7.069,62.6-62.6h14.142Zm-14.142-14.142h0l-7.07-7.069,48.454-48.454h14.142Zm-14.142-14.142h0l-7.07-7.069,34.312-34.312h14.142Zm-14.142-14.142h0l-7.07-7.069,20.17-20.17h14.142Zm-14.142-14.142h0l-7.071-7.071,6.027-6.027h14.144l-13.1,13.1Zm367.24-56.114v-.909l.455.455-.453.453Z" transform="translate(13472.546 -1236.766)" fill="var(--corner-fill)"></path></g></g></svg></div></div></div></div><noscript><img src="https://a.holt.courses/noscript.gif" alt="" referrerPolicy="no-referrer-when-downgrade"/></noscript><footer class="footer"><ul class="socials"><li class="social"><a href="https://twitter.com/holtbt"><svg fill="none" height="100%" width="32" xmlns="http://www.w3.org/2000/svg" viewBox="0.254 0.25 500 451.95400000000006"><path d="M394.033.25h76.67L303.202 191.693l197.052 260.511h-154.29L225.118 294.205 86.844 452.204H10.127l179.16-204.77L.254.25H158.46l109.234 144.417zm-26.908 406.063h42.483L135.377 43.73h-45.59z" fill="var(--footer-icons)"></path></svg></a></li><li class="social"><a href="https://bsky.app/profile/brianholt.me"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -3.268 64 68.414" width="38" height="100%"><path fill="var(--footer-icons)" d="M13.873 3.805C21.21 9.332 29.103 20.537 32 26.55v15.882c0-.338-.13.044-.41.867-1.512 4.456-7.418 21.847-20.923 7.944-7.111-7.32-3.819-14.64 9.125-16.85-7.405 1.264-15.73-.825-18.014-9.015C1.12 23.022 0 8.51 0 6.55 0-3.268 8.579-.182 13.873 3.805zm36.254 0C42.79 9.332 34.897 20.537 32 26.55v15.882c0-.338.13.044.41.867 1.512 4.456 7.418 21.847 20.923 7.944 7.111-7.32 3.819-14.64-9.125-16.85 7.405 1.264 15.73-.825 18.014-9.015C62.88 23.022 64 8.51 64 6.55c0-9.818-8.578-6.732-13.873-2.745z"></path></svg></a></li><li class="social"><a href="https://github.com/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-github-social"><rect width="32" height="32"></rect></clipPath></defs><g id="github-social" clip-path="url(#clip-github-social)"><g id="Group_272" data-name="Group 272" transform="translate(13522.5 -6994)"><path id="Subtraction_33" data-name="Subtraction 33" d="M-24967.5,8041a15.9,15.9,0,0,1-11.312-4.688A15.893,15.893,0,0,1-24983.5,8025a15.893,15.893,0,0,1,4.689-11.315A15.894,15.894,0,0,1-24967.5,8009a15.894,15.894,0,0,1,11.313,4.686A15.893,15.893,0,0,1-24951.5,8025a15.893,15.893,0,0,1-4.689,11.313A15.9,15.9,0,0,1-24967.5,8041Zm-3.781-4.571h0v3.918h7.895v-6.665a1.836,1.836,0,0,0-1.2-1.718c5.1-.617,7.467-2.975,7.467-7.424a7.176,7.176,0,0,0-1.637-4.728,6.74,6.74,0,0,0,.275-1.812,4.34,4.34,0,0,0-.52-2.452.574.574,0,0,0-.359-.1c-1.061,0-3.465,1.411-3.936,1.694a16.644,16.644,0,0,0-4.2-.489,16.379,16.379,0,0,0-3.969.445c-.846-.5-2.91-1.649-3.859-1.649a.566.566,0,0,0-.354.095,4.3,4.3,0,0,0-.521,2.452,6.7,6.7,0,0,0,.244,1.718,7.346,7.346,0,0,0-1.6,4.822,7.263,7.263,0,0,0,1.533,4.985c1.193,1.359,3.115,2.165,5.871,2.464a1.826,1.826,0,0,0-1.129,1.693v.5h0l-.006,0a7.121,7.121,0,0,1-2.033.363,2.608,2.608,0,0,1-.965-.158,4.438,4.438,0,0,1-1.836-1.881,2.361,2.361,0,0,0-1.248-1.091,3.472,3.472,0,0,0-1.217-.3.584.584,0,0,0-.545.224.282.282,0,0,0,.027.367,1.875,1.875,0,0,0,.447.307,4.732,4.732,0,0,1,.561.355,10.726,10.726,0,0,1,1.682,2.755c.043.092.078.163.105.217a3.876,3.876,0,0,0,2.42,1.185,6.036,6.036,0,0,0,.607.025c.875,0,1.988-.124,2-.125Z" transform="translate(11461 -1015)" fill="var(--footer-icons)"></path><g id="Ellipse_670" data-name="Ellipse 670" transform="translate(-13522.5 6994)" fill="none" stroke="var(--footer-icons)" stroke-width="1"><circle cx="16" cy="16" r="16" stroke="none"></circle><circle cx="16" cy="16" r="15.5" fill="none"></circle></g></g></g></svg></a></li><li class="social"><a href="https://linkedin.com/in/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-linkedin-social"><rect width="32" height="32"></rect></clipPath></defs><g id="linkedin-social" clip-path="url(#clip-linkedin-social)"><g id="Group_270" data-name="Group 270" transform="translate(-86.349 -633.073)"><path id="Path_375" data-name="Path 375" d="M115.789,633.073a2.324,2.324,0,0,1,1.682.676,2.194,2.194,0,0,1,.695,1.627V662.8a2.131,2.131,0,0,1-.695,1.609,2.314,2.314,0,0,1-1.646.659H88.69a2.307,2.307,0,0,1-1.646-.659,2.128,2.128,0,0,1-.695-1.609V635.376a2.19,2.19,0,0,1,.695-1.627,2.322,2.322,0,0,1,1.682-.676h27.063Zm-20.224,9.672a2.561,2.561,0,0,0,0-3.584,2.658,2.658,0,0,0-1.938-.712,2.724,2.724,0,0,0-1.957.712,2.371,2.371,0,0,0-.75,1.792,2.4,2.4,0,0,0,.731,1.792,2.605,2.605,0,0,0,1.9.713h.037A2.7,2.7,0,0,0,95.565,642.745ZM96,645.434H91.213V659.88H96Zm17.3,6.144a7.007,7.007,0,0,0-1.573-4.9,5.68,5.68,0,0,0-6.839-.769,5.663,5.663,0,0,0-1.426,1.573v-2.048H98.674q.036.841,0,7.717v6.728h4.791V651.8a3.592,3.592,0,0,1,.146-1.17,2.913,2.913,0,0,1,.878-1.206,2.429,2.429,0,0,1,1.609-.549,2.108,2.108,0,0,1,1.865.914,4.265,4.265,0,0,1,.549,2.341v7.752H113.3Z" fill="var(--footer-icons)"></path></g></g></svg></a></li><li class="social"><div class="terms"><p>Content Licensed Under CC-BY-NC-4.0</p><p>Code Samples and Exercises Licensed Under Apache 2.0</p><p>Site Designed by<!-- --> <a href="https://www.alexdanielson.com/">Alex Danielson</a></p></div></li></ul><div class="theme-icons"><link id="highlight-theme-light" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.8.0/styles/a11y-light.min.css"/><link id="highlight-theme-dark" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.8.0/styles/a11y-dark.min.css" disabled=""/><button aria-label="Activate dark mode" title="Activate dark mode" class="theme-toggle"><svg xmlns="http://www.w3.org/2000/svg" width="36px" height="100%" viewBox="0 -960 960 960" fill="var(--text-footer)" role="img"><title>Dark Mode Icon</title><path d="M480-120q-150 0-255-105T120-480q0-150 105-255t255-105q14 0 27.5 1t26.5 3q-41 29-65.5 75.5T444-660q0 90 63 153t153 63q55 0 101-24.5t75-65.5q2 13 3 26.5t1 27.5q0 150-105 255T480-120Zm0-80q88 0 158-48.5T740-375q-20 5-40 8t-40 3q-123 0-209.5-86.5T364-660q0-20 3-40t8-40q-78 32-126.5 102T200-480q0 116 82 198t198 82Z"></path></svg></button></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"attributes":{"title":"AI Inference"},"html":"\u003cp\u003eLet\u0026#39;s build!\u003c/p\u003e\n\u003cp\u003eIn your src directory, create an ai directory. In there put a summarize.ts file and put this in there\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { generateText } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;ai\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esummarizeArticle\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\n  \u003cspan class=\"hljs-attr\"\u003etitle\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003earticle\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e\n\u003c/span\u003e): \u003cspan class=\"hljs-title class_\"\u003ePromise\u003c/span\u003e\u0026lt;\u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!article || !article.\u003cspan class=\"hljs-title function_\"\u003etrim\u003c/span\u003e()) {\n    \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Article content is required to generate a summary.\u0026quot;\u003c/span\u003e);\n  }\n\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e prompt = \u003cspan class=\"hljs-string\"\u003e`Summarize the following wiki article in 1-2 concise sentences. Focus on the main idea and the most important details a reader should remember. Do not add opinions or unrelated information. The point is that readers can see the summary a glance and decide if they want to read more.\\n\\nTitle:\\n\u003cspan class=\"hljs-subst\"\u003e${title}\u003c/span\u003e\\n\\nArticle:\\n\u003cspan class=\"hljs-subst\"\u003e${article}\u003c/span\u003e`\u003c/span\u003e;\n\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { text } = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003egenerateText\u003c/span\u003e({\n    \u003cspan class=\"hljs-attr\"\u003emodel\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;openai/gpt-5-nano\u0026quot;\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003esystem\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;You are an assistant that writes concise factual summaries.\u0026quot;\u003c/span\u003e,\n    prompt,\n  });\n\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (text ?? \u003cspan class=\"hljs-string\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003etrim\u003c/span\u003e();\n}\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e summarizeArticle;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eI love the AI SDK. It\u0026#39;s a much nicer experience than say the OpenAI SDK\u0026#39;s rituals can be, in my opinion.\u003c/p\u003e\n\u003cp\u003eWhat\u0026#39;s cool about the AI SDK is you can easily switch it to use Anthropic, OpenAI, etc. directly instead of going through Vercel. Smart marketing on their part because it means you can use their SDK no matter what and it\u0026#39;s easy to switch to their AI Gateway\u003c/p\u003e\n\u003cp\u003eLet\u0026#39;s say you wanted to use Anthropic directly. Here\u0026#39;s what you\u0026#39;d do.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eI\u0026#39;m going to use the Vercel AI Gateway so only do these next steps if you want to switch. I just wanted to show you how easy it is to switch.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003enpm i @ai-sdk/anthropic\n\u003c/code\u003e\u003c/pre\u003e\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// at top\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { anthropic } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@ai-sdk/anthropic\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment\"\u003e// replace model\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003emodel\u003c/span\u003e: \u003cspan class=\"hljs-title function_\"\u003eanthropic\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;claude-haiku-4-5\u0026quot;\u003c/span\u003e),\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThat\u0026#39;s it! Now instead of going to Vercel\u0026#39;s AI Gateway, you\u0026#39;re going directly Anthropic. This would be helpful if you already had money on your Anthropic account and didn\u0026#39;t want to fill up a Vercel account. We\u0026#39;re not doing this, and we\u0026#39;re just going to use Vercel\u0026#39;s AI Gateway.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eI chose \u003ccode\u003eopenai/gpt-5-nano\u003c/code\u003e because it was cheapest of the frontier models as of writing. Summarizing is the most basic AI task and basically any model can do it pretty well. Feel free to experiment here. \u003ca href=\"https://vercel.com/ai-gateway/models\"\u003eHere are the models supported\u003c/a\u003e. Also, just throwing out that the prompt could be improved. This will do the job but feel free to iterate.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eOkay, let\u0026#39;s add it to our server actions. Update actions/articles.ts\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// at top\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e summarizeArticle \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@/ai/summarize\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment\"\u003e// replace db call in create\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e summary = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esummarizeArticle\u003c/span\u003e(data.\u003cspan class=\"hljs-property\"\u003etitle\u003c/span\u003e || \u003cspan class=\"hljs-string\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e, data.\u003cspan class=\"hljs-property\"\u003econtent\u003c/span\u003e || \u003cspan class=\"hljs-string\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e response = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e db.\u003cspan class=\"hljs-title function_\"\u003einsert\u003c/span\u003e(articles).\u003cspan class=\"hljs-title function_\"\u003evalues\u003c/span\u003e({\n  \u003cspan class=\"hljs-attr\"\u003etitle\u003c/span\u003e: data.\u003cspan class=\"hljs-property\"\u003etitle\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003econtent\u003c/span\u003e: data.\u003cspan class=\"hljs-property\"\u003econtent\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003eslug\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e + \u003cspan class=\"hljs-title class_\"\u003eDate\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003enow\u003c/span\u003e(),\n  \u003cspan class=\"hljs-attr\"\u003epublished\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003eauthorId\u003c/span\u003e: user.\u003cspan class=\"hljs-property\"\u003eid\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003eimageUrl\u003c/span\u003e: data.\u003cspan class=\"hljs-property\"\u003eimageUrl\u003c/span\u003e ?? \u003cspan class=\"hljs-literal\"\u003eundefined\u003c/span\u003e,\n  summary, \u003cspan class=\"hljs-comment\"\u003e// add\u003c/span\u003e\n});\n\n\u003cspan class=\"hljs-comment\"\u003e// replace db call in update\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e summary = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esummarizeArticle\u003c/span\u003e(data.\u003cspan class=\"hljs-property\"\u003etitle\u003c/span\u003e || \u003cspan class=\"hljs-string\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e, data.\u003cspan class=\"hljs-property\"\u003econtent\u003c/span\u003e || \u003cspan class=\"hljs-string\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e response = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e db\n  .\u003cspan class=\"hljs-title function_\"\u003eupdate\u003c/span\u003e(articles)\n  .\u003cspan class=\"hljs-title function_\"\u003eset\u003c/span\u003e({\n    \u003cspan class=\"hljs-attr\"\u003etitle\u003c/span\u003e: data.\u003cspan class=\"hljs-property\"\u003etitle\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003econtent\u003c/span\u003e: data.\u003cspan class=\"hljs-property\"\u003econtent\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003eimageUrl\u003c/span\u003e: data.\u003cspan class=\"hljs-property\"\u003eimageUrl\u003c/span\u003e ?? \u003cspan class=\"hljs-literal\"\u003eundefined\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003esummary\u003c/span\u003e: summary ?? \u003cspan class=\"hljs-literal\"\u003eundefined\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// add\u003c/span\u003e\n  })\n  .\u003cspan class=\"hljs-title function_\"\u003ewhere\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003eeq\u003c/span\u003e(articles.\u003cspan class=\"hljs-property\"\u003eid\u003c/span\u003e, +id));\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003eWe\u0026#39;re just using our new module and inserting into the database.\u003c/li\u003e\n\u003cli\u003eThe summary \u003cem\u003eand\u003c/em\u003e the title should always be there from the frontend. If it wasn\u0026#39;t then we\u0026#39;d need to select the necessary fields from the database and then do the summary. You could be more defensive here, but I\u0026#39;m keeping it simple.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eLet\u0026#39;s go add it to the database. Go to db/schema.ts\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// add the row\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003esummary\u003c/span\u003e: \u003cspan class=\"hljs-title function_\"\u003etext\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;summary\u0026quot;\u003c/span\u003e),\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eNow run these CLI commands\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003enpm run \u003cspan class=\"hljs-attr\"\u003edb\u003c/span\u003e:generate\nnpm run \u003cspan class=\"hljs-attr\"\u003edb\u003c/span\u003e:migrate\n\u003c/code\u003e\u003c/pre\u003e\u003cblockquote\u003e\n\u003cp\u003eYou may have a problem with untracked migrations, particularly if you played around with \u003ccode\u003edrizzle-kit push\u003c/code\u003e. There\u0026#39;s a bunch of ways to handle this, but I found the easiest way to just drop the articles table and \u003ccode\u003enpm run db:migrate\u003c/code\u003e again and then run \u003ccode\u003enpm run db:seed\u003c/code\u003e again.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eAwesome, now, finally, let\u0026#39;s add it to the select in data/articles.ts\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-typescript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// replace `getArticles` field\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003esummary\u003c/span\u003e: articles.\u003cspan class=\"hljs-property\"\u003esummary\u003c/span\u003e,\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eNow we can see the summary on the home page for new and edited articles!\u003c/p\u003e\n","markdown":"\nLet's build!\n\nIn your src directory, create an ai directory. In there put a summarize.ts file and put this in there\n\n```typescript\nimport { generateText } from \"ai\";\n\nexport async function summarizeArticle(\n  title: string,\n  article: string\n): Promise\u003cstring\u003e {\n  if (!article || !article.trim()) {\n    throw new Error(\"Article content is required to generate a summary.\");\n  }\n\n  const prompt = `Summarize the following wiki article in 1-2 concise sentences. Focus on the main idea and the most important details a reader should remember. Do not add opinions or unrelated information. The point is that readers can see the summary a glance and decide if they want to read more.\\n\\nTitle:\\n${title}\\n\\nArticle:\\n${article}`;\n\n  const { text } = await generateText({\n    model: \"openai/gpt-5-nano\",\n    system: \"You are an assistant that writes concise factual summaries.\",\n    prompt,\n  });\n\n  return (text ?? \"\").trim();\n}\n\nexport default summarizeArticle;\n```\n\nI love the AI SDK. It's a much nicer experience than say the OpenAI SDK's rituals can be, in my opinion.\n\nWhat's cool about the AI SDK is you can easily switch it to use Anthropic, OpenAI, etc. directly instead of going through Vercel. Smart marketing on their part because it means you can use their SDK no matter what and it's easy to switch to their AI Gateway\n\nLet's say you wanted to use Anthropic directly. Here's what you'd do.\n\n\u003e I'm going to use the Vercel AI Gateway so only do these next steps if you want to switch. I just wanted to show you how easy it is to switch.\n\n```bash\nnpm i @ai-sdk/anthropic\n```\n\n```typescript\n// at top\nimport { anthropic } from \"@ai-sdk/anthropic\";\n\n// replace model\nmodel: anthropic(\"claude-haiku-4-5\"),\n```\n\nThat's it! Now instead of going to Vercel's AI Gateway, you're going directly Anthropic. This would be helpful if you already had money on your Anthropic account and didn't want to fill up a Vercel account. We're not doing this, and we're just going to use Vercel's AI Gateway.\n\n\u003e I chose `openai/gpt-5-nano` because it was cheapest of the frontier models as of writing. Summarizing is the most basic AI task and basically any model can do it pretty well. Feel free to experiment here. [Here are the models supported][gateway]. Also, just throwing out that the prompt could be improved. This will do the job but feel free to iterate.\n\nOkay, let's add it to our server actions. Update actions/articles.ts\n\n```typescript\n// at top\nimport summarizeArticle from \"@/ai/summarize\";\n\n// replace db call in create\nconst summary = await summarizeArticle(data.title || \"\", data.content || \"\");\nconst response = await db.insert(articles).values({\n  title: data.title,\n  content: data.content,\n  slug: \"\" + Date.now(),\n  published: true,\n  authorId: user.id,\n  imageUrl: data.imageUrl ?? undefined,\n  summary, // add\n});\n\n// replace db call in update\nconst summary = await summarizeArticle(data.title || \"\", data.content || \"\");\nconst response = await db\n  .update(articles)\n  .set({\n    title: data.title,\n    content: data.content,\n    imageUrl: data.imageUrl ?? undefined,\n    summary: summary ?? undefined, // add\n  })\n  .where(eq(articles.id, +id));\n```\n\n- We're just using our new module and inserting into the database.\n- The summary _and_ the title should always be there from the frontend. If it wasn't then we'd need to select the necessary fields from the database and then do the summary. You could be more defensive here, but I'm keeping it simple.\n\nLet's go add it to the database. Go to db/schema.ts\n\n```typescript\n// add the row\nsummary: text(\"summary\"),\n```\n\nNow run these CLI commands\n\n```typescript\nnpm run db:generate\nnpm run db:migrate\n```\n\n\u003e You may have a problem with untracked migrations, particularly if you played around with `drizzle-kit push`. There's a bunch of ways to handle this, but I found the easiest way to just drop the articles table and `npm run db:migrate` again and then run `npm run db:seed` again.\n\nAwesome, now, finally, let's add it to the select in data/articles.ts\n\n```typescript\n// replace `getArticles` field\nsummary: articles.summary,\n```\n\nNow we can see the summary on the home page for new and edited articles!\n\n[gateway]: https://vercel.com/ai-gateway/models\n","slug":"ai-inference","title":"AI Inference","section":"AI","icon":"robot","filePath":"/home/runner/work/build-a-fullstack-nextjs-app-v4/build-a-fullstack-nextjs-app-v4/lessons/08-ai/B-ai-inference.md","nextSlug":"/lessons/ai/cron","prevSlug":"/lessons/ai/vercel-ai-gateway"}},"__N_SSG":true},"page":"/lessons/[section]/[slug]","query":{"section":"ai","slug":"ai-inference"},"buildId":"XOcKuB9gZ84DgFGtHvLgN","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>